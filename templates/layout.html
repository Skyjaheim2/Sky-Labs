{% extends "base.html" %}

{% block head %}
{% endblock %}

{% block style %}
<style>

    #mainHeading {
        text-align: center;
        font-family: 'Times New Roman', Times, serif;
        font-size: 35px;
        font-weight: bold;
    }
    #selectedSubjectTabHeading {
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 30px;
        font-weight: 400;
        /*margin-left: 20%;*/
        margin-bottom: 30px;
        margin-top: 20px;
    }
    #desmosGraph {
        margin: auto;
    }
    .inputLabel {
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 18px;
        font-weight: 500;
    }
    .subject-tabs {
        height: 55px;
        background-color: #393737;
        margin-top: 80px;
        margin-bottom: 0;
        padding-left: 19.4%;
    }
    .subject-tab-btn {
        border-radius: 15px;
        height: 50px;
    }
    .subject-topics {
        display: none;
        font-family: "Times New Roman", Symbola, serif;
        position: absolute;
        background-color: white;
        left: 275px;
        height: auto;
        width: 410px;
        /*width: auto;*/
        border: 1px solid #c7c7c7;
    }
    .subject-option-btn {
        width: 200px;
        margin: 2px;


    }
    .btn-secondary {
        position: relative;
        margin-top: 5px;
        font-family: "Times New Roman", Symbola, serif;
        background-color: #393737;
        border: none;
    }
    .symbols-container {
        background-color: #e0dddd;
        border-radius: 10px;
        height: 150px;
        margin-bottom: 20px;
        margin-top: 10px;
    }
    #sidebar {
        border-radius: 10px;
        background-color: #e0dddd;
        /*position: absolute;*/
        /*top: 32%;*/

    }
    .topics-btn {
        /*width: 200px;*/
        font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman',serif;
        /*font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;*/
        padding: 5px 10px;
        margin-left: 10px;
        margin-right: 10px;
        border: none;
        /*border-top: 1px solid darkgray;*/
        font-size: 15px;
        background-color: #e0dddd;

    }
    .extension-topics-container {
        background-color: #e0dddd;
    }
    .symbol-btn {
        margin: 5px;
    }
    .topic-extension-item {
        text-decoration: none;
        color: black;
        cursor: pointer;
    }
    .topic-extension-item:hover {
        color: black;
    }
    .topic-extension-heading {
        font-family: "Times New Roman", Symbola, serif;
        color: #848484;
        /*font-weight: 0;*/
        /*font-size: 30px;*/
        /*font-weight: 350;*/
    }
    .heading-container {
        width: 100%;
    }
    .subject-heading-container {
        width: 100%;
        margin-left: 10px;
    }
    .sidebar-container {
        margin-left: 10px;
        /*padding: 10px;*/

    }
    .container-1 {
        display: flex;
        flex-wrap: wrap;
    }
    .container-2 {
        margin-left: 5%;
        width: 805px;

    }
    /* STEPS */
    .main-container {
        /*margin-left: 20%;*/
        /*margin-right: 20%;*/
    }
    .results-container {
       /* animation-name: showAllSteps;
        animation-delay: 0.5s;
        animation-duration: 2s;
        animation-fill-mode: forwards;*/
        /*display: none;*/
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 15px;
        background-color: rgba(226, 226, 226, 0.45);
        border-radius: 15px;
        padding: 20px;
        /*height: 0;*/
        overflow-y: hidden;
    }
    #finalSolutionHeading {
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 17px;
        margin-bottom: 20px;
        overflow-y: hidden;
        overflow-x: auto;
    }
    .final-result {
        font-size: 20px;
    }
    .steps-heading {
        display: none;
        margin-top: 10px;
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 25px;
        font-weight: 600;
    }
    .steps-container {
        background-color: white;
        padding: 10px;
        border-radius: 10px;
        /*height: 400px;*/
    }
    .step-description {
        background-color: rgba(226, 226, 226, 0.45);
        /*font-family: "Times New Roman", Symbola, serif;*/
        /*font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;*/
        font-size: 15px;
        padding: 5px;
        border-radius: 10px;
        margin-bottom: 8px;
        /*margin-top: 50px;*/
    }
    .katex {
        /*font-family: "Times New Roman", Symbola, serif;*/
        /*font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;*/
        font-family: 'Computer Modern',serif;
    }
    .expandable-step-container {
        background-color: rgba(215, 213, 213, 0.45);
        font-family: "Times New Roman", Symbola, serif;
        font-size: 17px;
        padding: 7px;
        border-radius: 10px;
        margin-top: 0;
        margin-bottom: 0;
        overflow-x: hidden;

    }
    .show-steps-span {
        font-family: "Times New Roman", Symbola, serif;
        font-size: 16px;
        float: right;
        cursor: pointer;
    }
    .show-steps-icon {
        width: 25px;
        height: 25px;
    }
    .expanded-step-heading {
        font-size: 16px;
        margin-top: 11px;
    }
    .expandable-step-solution-container {
        /*animation-name: stepExpanded;*/
        /*animation-delay: 0.5s;*/
        /*animation-duration: 1s;*/
        /*animation-fill-mode: forwards;*/
        /*display: none;*/
        overflow: hidden;
        border-radius: 10px;
        margin-top: 3px;
        margin-bottom: 3px;
        height: 0;
    }
    .step-info {
        font-size: 17px;
        margin-top: 11px;
        margin-bottom: 15px;
        overflow-y: hidden;
        overflow-x: auto;
        /*overflow-y: visible;*/
        /*height: 50px;*/
        white-space: nowrap;
    }
    .final-step {
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 17px;
        font-weight: 600;
        margin-top: 10px;
        overflow-y: visible;
        /*overflow-x: auto;*/
    }
    @keyframes stepExpanded {
        from {
            height: 0;
            padding: 0;
            box-shadow: none;
        }
        to {
            height: 300px;
            padding: 10px;
            box-shadow: 0 0 3px 3px rgba(0, 0, 0, 0.5);
        }

    }
    @keyframes stepCollapsed {
        from {
            height: 300px;
            padding: 10px;
            box-shadow: 0 0 3px 3px rgba(0, 0, 0, 0.5);
        }
        to {
            height: 0;
            padding: 0;
            box-shadow: none;
            /*padding-top: 40px;*/
        }
    }
    @keyframes showAllSteps {
        0% {
            max-height: 0;
          }

          100% {
            max-height: 2000px;
          }
    }
</style>

{% block style1 %}
{% endblock %}

{% endblock %}


{% block heading_items %}
    <div class="subject-tabs">  
        <div class="btn-group">
            <button id="algebraSubjectTabBtn" class="btn btn-secondary subject-tab-btn" data-subject="algebra">Algebra</button>
            <button id="discreteMathSubjectTabBtn" class="btn btn-secondary subject-tab-btn" data-subject="discreteMath">Discrete Math</button>
            <button id="calculusSubjectTabBtn" class="btn btn-secondary subject-tab-btn" data-subject="calculus">Calculus</button>
            <button id="probabilitySubjectTabBtn" class="btn btn-secondary subject-tab-btn" data-subject="probability">Probability</button>
            <button id="physicsSubjectTabBtn" class="btn btn-secondary subject-tab-btn" data-subject="physics">Physics</button>
        </div>
    </div>  

    <div class="subject-topics"></div>

{% endblock %}

{% block body %}
    <div class="subject-heading-container">
        <div id="selectedSubjectTabHeading"></div>
    </div>

    <div class="sidebar-container">
        <div id="sidebar"></div>
    </div>

    <div class="container-2">
        <div class="symbols-container"></div>

        <div class="main-container">
            {% block subject_features %}
            {% endblock %}

            <div class="results-container">

                <div id="desmosGraph" style="display: none; width: 750px; height: 400px;"></div>

                <div id="finalSolutionHeading"></div>
                <div class="steps-heading">Steps</div>
                <div class="steps-container"></div>

            </div>
        </div>

    </div>  
{% endblock %}


{% block script %}

<script>
    // let e_steps_count = 1
    class StepsUI {
        constructor() {
            this.main_steps_count = 1;
            this.e_steps_count = 1;
        }

        static displayResult(resultText) {
            let resultContainer = document.querySelector('.results-container')
            let resultDiv = document.createElement('div')
            resultDiv.textContent = resultText
            resultContainer.appendChild(resultDiv)
        }
        displayStep(container, step, type, e_step_id) {
            e_step_id = this.e_steps_count
            // console.log(foo)
            // console.log(num_e_steps_added)
            if (type === 'main-step') {
                container.innerHTML += `
                    <div class="step-description">${step['description']}</div>
                    <div class="step-info">${step['info']}</div>
                `
            }
            else if (type === 'e-step') {
                this.e_steps_count += 1

                container.innerHTML += `<div id="e-step-${e_step_id}" class="expandable-step-container"><span class="expandable-step">${step['heading']}</span><span class="show-steps-span">Show Steps <img class="show-steps-icon" src="{{ url_for('static', filename='img/add.svg') }}"></span></div>`
                let e_stepSolutionContainer = document.createElement('div')
                e_stepSolutionContainer.id = `e-step-solution-${e_step_id}`
                e_stepSolutionContainer.className = 'expandable-step-solution-container'
                e_stepSolutionContainer.dataset.expanded = 'false'

                e_stepSolutionContainer.innerHTML += `<div class="expanded-step-heading">${step['heading'].split('=')[0]}</div>`
                e_stepSolutionContainer.innerHTML += `<hr>`

                let e_Steps = step['e-steps']
                e_Steps.forEach((e_step) => {
                    if (e_step['type'] === 'main-step') {
                        this.displayStep(e_stepSolutionContainer, e_step, 'main-step', e_step_id)
                    }
                    else if (e_step['type'] === 'e-step') {
                        // let num_e_steps_added = document.querySelectorAll('.expandable-step-container')
                        // console.log(num_e_steps_added)

                        this.displayStep(e_stepSolutionContainer, e_step, 'e-step', e_step_id+1)
                    }
                })
                container.appendChild(e_stepSolutionContainer)

            }

        }
        static displayStepsHeading() {
            let stepsHeading = document.querySelector('.steps-heading')
            stepsHeading.style.display = 'block'
        }
        static addLatexToSteps(finalResult, enteredMath) {
            // Add Latex to all .step-descriptions
            document.querySelectorAll('.step-description').forEach((description) => {
                StepsUI.addLatexToElement(description, description.textContent)
            })
            // Add Latex to all .step-info
            document.querySelectorAll('.step-info').forEach((info) => {
                StepsUI.addLatexToElement(info, info.textContent)
            })
            // Add Latex to all .expandable-step
            document.querySelectorAll('.expandable-step').forEach((step) => {
                StepsUI.addLatexToElement(step, step.textContent)
            })
            // Add Latex to all .expandable-step-solution-container
            document.querySelectorAll('.expandable-step-solution-container').forEach((container) => {
                // StepsUI.addLatexToElement(container, container.textContent)
            })
            // Add Latex to all .expanded-step-heading
            document.querySelectorAll('.expanded-step-heading').forEach((heading) => {
                StepsUI.addLatexToElement(heading, heading.textContent)
            })
            // Add latex to .final-step
            StepsUI.addLatexToElement(document.querySelector('.final-step'), `\\displaystyle \\text{Solution:}\\ ${finalResult}`)
            /* Add Latex To Solution Heading */

            // Check for keyword
            const allKeywords = ['simplify', 'combine'];
            let keyword;
            let userInput;
            let inputItems = enteredMath.split(' ');
            if (allKeywords.includes(inputItems[0].replaceAll('\\', ''))) {
                keyword = inputItems[0].replaceAll('\\', '');
                userInput = '';
                inputItems.splice(1).forEach((item) => {
                    if (item.slice(-4) === 'cdot') item = `${item} ` // replace \cdotx with \cdot x
                    userInput += item;
                })
            }
            else {
                userInput = enteredMath;
            }

            StepsUI.addLatexToElement(document.querySelector('#finalSolutionHeading'), `{\\displaystyle ${userInput}=${finalResult}}`)

        }
        static makeStepsExpandable() {
            let numExpandableSteps = document.querySelectorAll('.expandable-step-container').length

            for (let i = 1; i <= numExpandableSteps; i++) {
                document.querySelector(`#e-step-${i}`).addEventListener('click', (e) => {
                    let stepContainer = document.querySelector(`#e-step-solution-${i}`)
                    if (e.target.className === 'show-steps-span') {
                        if (stepContainer.dataset.expanded === 'false') {
                            e.target.innerHTML = `Hide Steps <img class="show-steps-icon" src="{{ url_for('static', filename='img/minus.svg') }}">`
                            stepContainer.style.overflow = 'auto'
                            Animations.animateShowSteps(stepContainer)
                        }
                        else {
                            e.target.innerHTML = `Show Steps <img class="show-steps-icon" src="{{ url_for('static', filename='img/add.svg') }}">`
                            Animations.animateHideSteps(stepContainer)
                            $(stepContainer).animate({scrollTop: 0}, "fast");
                            stepContainer.style.overflow = 'hidden'
                        }

                    }
                    
                })
            }
        }
        static addLatexToElement(element, latexString) {
            katex.render(String.raw`${latexString}`, element, {
                throwOnError: false
            });
        }
        static showAllSteps(solution, enteredExpression) {
            let stepsContainer = document.querySelector('.steps-container')
            let allSimplifications = extractAllSimplificationsFromSolution(solution)
            let stepCounter = 1

            /* Clear any previous steps */
            stepsContainer.innerHTML = ''

            for (let stepNum in solution) {
                let currentStep = new Step(solution[stepNum])


                if (!(currentStep.isFinalStep)) {
                    let latexStepDescriptionSpan = document.createElement('span')
                    let latexStepInfoSpan = document.createElement('span')

                    /* Create step description */
                    let stepDescriptionDiv = document.createElement('div')
                    stepDescriptionDiv.className = 'step-description'
                    stepDescriptionDiv.textContent = `${currentStep.description}: `
                    stepDescriptionDiv.appendChild(latexStepDescriptionSpan)
                    /* Create step info */
                    let stepInfoDiv = document.createElement('div')
                    stepInfoDiv.className = 'step-info'
                    stepInfoDiv.appendChild(latexStepInfoSpan)

                    /* Add step description and step info to stepsContainer */
                    stepsContainer.appendChild(stepDescriptionDiv)
                    stepsContainer.appendChild(stepInfoDiv)


                    /* Add latex */
                    StepsUI.addLatexToElement(latexStepDescriptionSpan, currentStep.result)
                    if (stepCounter === 1) {
                        StepsUI.addLatexToElement(latexStepInfoSpan, `${enteredExpression} = ${currentStep.simplification}`)
                    }
                    else {
                        /* Show the the previous simplification for currentStep step-info */
                        StepsUI.addLatexToElement(latexStepInfoSpan, `${allSimplifications[stepCounter-1]} = ${allSimplifications[stepNum]}`)
                    }

                }
                else {
                    let lastStepInfoDiv = stepsContainer.lastElementChild
                    lastStepInfoDiv.className = 'final-step'
                    lastStepInfoDiv.textContent = 'Solution: '

                    let latexFinalStepSpan = document.createElement('span')

                    lastStepInfoDiv.appendChild(latexFinalStepSpan)

                    StepsUI.addLatexToElement(latexFinalStepSpan, solution[stepCounter])

                }
                stepCounter += 1
            }

        }
        static getUserInput() {
            return document.querySelector('#userInput').value
        }
        static addGraphElementToDOM() {
            const resultsContainer = document.querySelector('.results-container');
            const desmosGraph = document.createElement('div');
            desmosGraph.id = 'desmosGraph';
            desmosGraph.style.display = 'none';
            desmosGraph.style.width = '750px';
            desmosGraph.style.height = '400px';
            resultsContainer.appendChild(desmosGraph);
        }
        addStepsToDOM(enteredMath, requestFromHistory, liveSolve, addSolutionToLS) {
            let resultsContainer = document.querySelector('.results-container');
            // Clear previous work
            resultsContainer.innerHTML = `
                <div id="finalSolutionHeading"></div>
                <div class="steps-heading">Steps</div>
                <div class="steps-container"></div>
            `;

            StepsUI.addGraphElementToDOM();
            var graphElement = document.getElementById('desmosGraph');
            var desmosGraph = Desmos.GraphingCalculator(graphElement, {
                'lockViewport': false,
                'expressions': true, // Show list of expressions on the side
                'expressionsCollapsed': true,
                'settingsMenu': true,
                'keypad': false
            });

            let selectedTopic = BaseUI.getSelectedTopic();
            let subjectAndTopic = {'subject': 'algebra', 'selectedTopic': selectedTopic};


            const request = new XMLHttpRequest();
            request.open('POST', `/solve/${requestFromHistory}/${liveSolve}`);
            request.onload = () => {
                if (request.status === 200) {
                    let response = request.responseText;
                    response = JSON.parse(response);
                    if (response.message === 'graph') {

                        graphElement.style.display = 'block';
                        const functionToGraph = response.content.functionToGraph;

                        desmosGraph.setExpression({id: 'graph1', latex: `${functionToGraph}`});

                        if (addSolutionToLS) {
                            let solution = {'finalResult': `${enteredMath}`, 'steps': [], 'enteredMath': `${enteredMath}`};
                            solution['enteredMath'] = enteredMath;
                            Storage.addLastSolution(solution);
                        }
                        document.querySelector('.steps-container').style.display = 'none';
                        StepsUI.addLatexToElement(document.querySelector('#finalSolutionHeading'), `{\\displaystyle \\text{Graphing} \\ ${functionToGraph}}`)


                    }
                    else if (response.message === 'solved') {
                        let solution = response.content;
                        let Steps = solution['steps']
                        let finalResult = solution['finalResult']
                        let stepsContainer = document.querySelector('.steps-container')

                        let e_step_id = 1
                        Steps.forEach((step) => {
                            if (step['type'] === 'main-step') {
                                this.displayStep(stepsContainer, step, 'main-step')
                            } else if (step['type'] === 'e-step') {
                                // console.log(e_step_id)
                                this.displayStep(stepsContainer, step, 'e-step', e_step_id)
                                let num_e_steps_added = document.querySelectorAll('.expandable-step-container').length
                                e_step_id = num_e_steps_added + 1
                            }
                        })
                        stepsContainer.innerHTML += `<div class="final-step"></div>`

                        StepsUI.addLatexToSteps(finalResult, enteredMath)
                        StepsUI.makeStepsExpandable()

                        if (addSolutionToLS) {
                            solution['enteredMath'] = enteredMath
                            Storage.addLastSolution(solution)
                        }

                        Animations.animateShowAllSteps()
                    }

                    else {
                        UI.showAlert('Unable To Solve', 'danger');
                    }
                }
                // document.querySelector('.results-container').style.height = '0'
            }
            const data = new FormData()
            data.set('userInput', enteredMath)
            data.set('subjectAndTopic', JSON.stringify(subjectAndTopic))
            request.send(data)
        }
    }
    class Step {
        constructor(stepDict) {
            if (typeof stepDict === 'object' && typeof stepDict !== null) {
                this.simplification = stepDict['simplification']
                this.step = stepDict['step']
                this.isFinalStep = false
                this.description = this.step.split(': ')[0]
                this.result = this.step.split(': ')[1]

            }
            else {
                this.simplification = stepDict
                this.step = stepDict
                this.isFinalStep = true
            }
        }
    }
    class BaseUI {
        static userLoggedIn() {
                let loginBtn = document.querySelector('#loginBtn')
                let signUpBtn = document.querySelector('#signUpBtn')
                let signOutBtn = document.querySelector('#signOutBtn')

                // Hide login and sign-up btn
                loginBtn.style.display = 'none'
                signUpBtn.style.display = 'none'
                // Show signOutBtn btn
                signOutBtn.style.display = 'block'
            }

        static userSignedOut() {
            let loginBtn = document.querySelector('#loginBtn')
            let signUpBtn = document.querySelector('#signUpBtn')
            let signOutBtn = document.querySelector('#signOutBtn')

            // Show login and sign-up btn
            loginBtn.style.display = 'block'
            signUpBtn.style.display = 'block'
            // Hide signOutBtn
            signOutBtn.style.display = 'none'
        }
        static loadDefaultOptions(defaultSubject) {
            // Load Default Subject Tab
            let defaultSubjectTabBtn = document.querySelector(`#${defaultSubject}SubjectTabBtn`)
            let subjectTopicsContainer = document.querySelector('.subject-topics')
            let subjectOptions = subjectTabsUI.getSubjectOptions()

            subjectOptions[defaultSubject].forEach((topic) => {
                subjectTopicsContainer.innerHTML += `<button class="btn btn-light subject-option-btn">${topic}</button>`
            })
            subjectTabsUI.subjectTabBtnSelected(defaultSubjectTabBtn)
        }
        static loadSymbolsContainer() {

            // <button className="btn btn-light symbol-btn">$ x^2 $</button>
            // <button className="btn btn-light symbol-btn">$ x^{\square} $</button>
            // <button className="btn btn-light symbol-btn">$ \frac{\square}{\square} $</button>

            let symbolsContainer = document.querySelector('.symbols-container')

            let symbolsToAdd = [
                {
                    'symbol': 'x^2',
                    'latex': '\\left( \\right)^2',
                },
                {
                    'symbol': 'x^{\\square}',
                    'latex': '\\left( \\right)^{}',
                },
                {
                    'symbol': '\\log_{\\square}',
                    'latex': '\\log_{}\\left( \\right)',
                },
                {
                    'symbol': '\\sqrt{\\square}',
                    'latex': '\\sqrt{}',
                },
                {
                    'symbol': '\\sqrt[\\square]{\\square}',
                    'latex': '\\sqrt[]{}'
                },
                {
                    'symbol': '\\leq',
                    'latex': '\\leq',
                },
                {
                    'symbol': '\\geq',
                    'latex': '\\geq',
                },
                {
                    'symbol': '\\frac{\\square}{\\square}',
                    'latex': '\\frac{}{}',
                },
                {
                    'symbol': '\\cdot',
                    'latex': '\\cdot',
                },
                {
                    'symbol': '\\div',
                    'latex': '\\div',
                },
                {
                    'symbol': 'x^{\\circ}',
                    'latex': '\\left( \\right)^{\\circ}',
                },
                {
                    'symbol': '\\pi',
                    'latex': '\\pi',
                },
                {
                    'symbol': "(\\square)'",
                    'latex': "\\left( \\right)'",
                },
                {
                    'symbol': '\\frac{d}{dx}',
                    'latex': '\\frac{d}{dx}\\left( \\right)',
                },
                {
                    'symbol': '\\frac{\\partial}{\\partial x}',
                    'latex': '\\frac{\\partial}{\\partial x}\\left( \\right)',
                },
                {
                    'symbol': '\\int',
                    'latex': '\\int',
                },
                {
                    'symbol': '\\iint',
                    'latex': '\\int \\int',
                },
                {
                    'symbol': '\\iiint',
                    'latex': '\\int \\int \\int',
                },
                {
                    'symbol': '\\int_{\\square}^{\\square}',
                    'latex': '\\int_{}^{}',
                },
                {
                    'symbol': '\\lim',
                    'latex': '\\lim_{x \\to 0}\\left( \\right)',
                },
                {
                    'symbol': '\\sum',
                    'latex': '\\sum_{n=1}\\left( \\right)',
                },
                {
                    'symbol': '\\infty',
                    'latex': '\\infty',
                },
                {
                    'symbol': '\\theta',
                    'latex': '\\theta',
                },
                {
                    'symbol': 'f(x)',
                    'latex': 'f(x)',
                },
                {
                    'symbol': '\\ln',
                    'latex': '\\ln\\left( \\right)',
                },
                {
                    'symbol': 'e^{\\square}',
                    'latex': 'e^{}',
                },
                {
                    'symbol': '\\sin',
                    'latex': '\\sin\\left( \\right)',
                },
                {
                    'symbol': '\\cos',
                    'latex': '\\cos\\left( \\right)',
                },
                {
                    'symbol': '\\tan',
                    'latex': '\\tan\\left( \\right)',
                },
                {
                    'symbol': '\\cot',
                    'latex': '\\cot\\left( \\right)',
                },
                {
                    'symbol': '\\csc',
                    'latex': '\\csc\\left( \\right)',
                },
                {
                    'symbol': '\\sec',
                    'latex': '\\sec\\left( \\right)',
                },
                {
                    'symbol': '\\sinh',
                    'latex': '\\sinh\\left( \\right)',
                },
                {
                    'symbol': '\\cosh',
                    'latex': '\\cosh\\left( \\right)',
                },
                {
                    'symbol': '\\tanh',
                    'latex': '\\tanh\\left( \\right)',
                },
                {
                    'symbol': '\\arcsin',
                    'latex': '\\arcsin\\left( \\right)',
                },
                {
                    'symbol': '\\arccos',
                    'latex': '\\arccos\\left( \\right)',
                },
                {
                    'symbol': '\\arctan',
                    'latex': '\\arctan\\left( \\right)',
                },

            ]

            symbolsToAdd.forEach((item) => {
                let symbol = item['symbol']
                let latex = item['latex']

                let symbolButton = document.createElement('button')
                symbolButton.className = 'btn btn-light symbol-btn'
                symbolButton.dataset.latex = latex

                symbolsContainer.appendChild(symbolButton)
                StepsUI.addLatexToElement(symbolButton, symbol)
            })
        }

        static extensionTopicClicked(mainTopic, extensionTopic) {
            let mainHeading = document.querySelector('#selectedSubjectTabHeading')
            let delimiter
            if (extensionTopic !== '')
                delimiter = '→'
            else
                delimiter = ''

            if (mainHeading.innerHTML.includes('topic-extension-heading')) {
                let topicExtensionHeading = document.querySelector('.topic-extension-heading')
                topicExtensionHeading.innerHTML = `${mainTopic}${delimiter}${extensionTopic}`
            }
            else {
                mainHeading.innerHTML += `<span class="topic-extension-heading"> ${mainTopic}${delimiter}${extensionTopic}</span>`
            }

            // mainHeading.innerHTML += `<span class="topic-extension-heading"> ${mainTopic}→${extensionTopic}</span>`
        }
        static getSelectedTopic() {
            let selectedSubjectHeading = document.querySelector('#selectedSubjectTabHeading')
            if (selectedSubjectHeading.children.length !== 0) {
                return selectedSubjectHeading.children[0].textContent.trim()
            }
            else {
                return selectedSubjectHeading.textContent
            }
        }

        
    }
    class subjectTabsUI {
        static subjectTabBtnSelected(btnObj) {
            let subjectTabHeading = document.querySelector('#selectedSubjectTabHeading')
            let allBtnObjects = document.querySelectorAll('.subject-tab-btn')
            allBtnObjects.forEach((btn) => {
                if (btn !== btnObj) {
                    btn.style.backgroundColor = ''
                }
                else {
                    btn.style.backgroundColor = 'black'
                }
            })
            subjectTabHeading.innerHTML = `${btnObj.textContent}`
            // this.loadSideBarBtn(btnObj.dataset.subject)
            this.loadSideBarBtn2(btnObj.dataset.subject)
        }
        static showSubjectTopics() {
            let subjectOptionsContainer = document.querySelector('.subject-topics')
            subjectOptionsContainer.style.display = 'flex'
            subjectOptionsContainer.style.flexWrap = 'wrap'
        }
        static removeSubjectTopics() {
            let subjectOptionsContainer = document.querySelector('.subject-topics')
            subjectOptionsContainer.style.display = 'none'
        }
        static populateSubjectOptions(Topics) {
            let subjectOptionsDiv = document.querySelector('.subject-topics')

            let htmlToAdd = ''
            Topics.forEach((topic) => {
                htmlToAdd += `<button class="btn btn-light subject-option-btn">${topic}</button>`
            })
            subjectOptionsDiv.innerHTML = htmlToAdd
        }
        static loadSideBarBtn(subject) {
            let sideBar = document.querySelector('.sidebar')
            let subjectTopicsContainer = document.querySelector('.subject-topics')

            let sideBarBtnHtml = ''

            subjectTopicsContainer.childNodes.forEach((btn) => {
                let topic = btn.textContent
                sideBarBtnHtml +=  `
                    <div class="dropdown">
                        <button style="background-color: darkgray; color: black" class="btn btn-secondary dropdown-toggle topics-btn" type="button" id="${topic}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            ${topic}
                        </button>
                        ${subjectTabsUI.getTopicsExtension(subject, topic)}
                    </div>
                `
            })
            sideBar.innerHTML = sideBarBtnHtml
        }
        static loadSideBarBtn2(subject) {
            let sideBar = document.querySelector('#sidebar')
            let subjectTopicsContainer = document.querySelector('.subject-topics')

            let sideBarBtnHtml = ''

            subjectTopicsContainer.childNodes.forEach((btn) => {
                let topic = btn.textContent
                let extensionTopics = this.getTopicsExtension2(subject, topic)

                let extendTopicsSymbol
                let extensionTopicsHtml

                if (extensionTopics.length === 124) {
                    extendTopicsSymbol = '&nbsp;&nbsp;'
                    extensionTopicsHtml = ''
                }
                else {
                    extendTopicsSymbol = '+'
                    extensionTopicsHtml = `
                        <div class="collapse" id="${topic}">
                            <div class="card card-body extension-topics-container">
                                <p style="font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
                                    font-size:small;">
                                    ${extensionTopics}
                                </p>
                            </div>
                        </div>
                    `
                }
                sideBarBtnHtml +=  `
                    <p>
                        <a class="btn btn-light topics-btn" data-toggle="collapse" href="#${topic}" role="button" aria-expanded="false" aria-controls="collapseExample"
                           style="">
                            ${extendTopicsSymbol}&nbsp; ${replaceAll(topic, '-', ' ')}
                        </a>
                    </p>
                    ${extensionTopicsHtml}
                `
            })
            sideBar.innerHTML = sideBarBtnHtml
        }
        static getTopicsExtension2(subject, topic) {
            let topicsExtension = {
                'algebra': {
                    'Basic-Operations': ['Addition', 'Subtraction', 'Multiplication', 'Division'],
                    'Equations': ['Linear', 'Quadratic', 'Logarithmic', 'Exponential'],
                    'Summation': ['Single Summation', 'Double Summation', 'Triple Summation'],
                    'Pi-Product-Notation': ['Single Product', 'Double Product', 'Triple Product'],
                    'Polynomials': ['Properties', 'Add', 'Subtract', 'Multiply', 'Divide', 'Factor'],
                    'Rational-Expressions': ['Add', 'Subtract', 'Multiply', 'Divide', 'LCM', 'Reduce']
                },
                'discreteMath': {
                    'Propositional-Logic': ['Truth Table', 'Logical Equivalence', 'Rules of Inference'],
                    'Set-Theory': ['Cartesian Product', 'Power Sets', 'Union', 'Intersection', 'Difference', 'Symmetric Difference', 'Computer Representation'],
                    'Induction': ['Prove Summation Formulas'],
                    'Number-Theory': ['Division Algorithm', 'Euclidean Algorithm', 'Arithmetic Modulo m', 'Modular Exponentiation', 'Congruences'],
                    'Relations': ['Properties', 'Combining Relations']
                },
                'calculus': {
                    'Limits': ['One Variable', 'Multi Variable', 'One Sided', 'At Infinity', "L'Hopital's Rule", 'Squeeze Theorem'],
                    'Derivatives': ['Sum/Diff Rule', 'Product Rule', 'Quotient Rule', 'Chain Rule', 'First Derivative', 'Higher Order Derivatives', 'Derivative At a Point', 'Partial Derivative', 'Implicit Derivative', 'Second Implicit Derivative', 'Derivative Using Definition'],
                    'Derivative-Applications': ['Equation of Tangent Line', 'Equation of Normal Line', 'Extreme Points', 'Linear Approximation', 'Quadratic Approximation', 'Related Rates', 'Optimization'],
                    'Integrals': ['Indefinite', 'Definite', 'Improper', 'Double Integrals', 'Triple Integrals', 'Numerical Integration'],
                    'Integral-Applications': ['Limit of Sum', 'Area Under Curve', 'Area Between Curves', 'Volume of Solid of Revolution', 'Function Average', 'Arc Length', 'Surface Area'],
                },
                'probability': {
                    'Distributions': ['Normal Distribution', 'Exponential Distributions'],
                    'Expected Value': [''],
                    'Variance': [''],
                    'Bayes Theorem': [''],
                    'Combinations': [''],
                    'Permutations': [''],

                },
                'physics': {
                    'Kinematics': ['1D Kinematics', '2D Kinematics'],
                    'Circular-Motion': ['Centripetal Force', 'Centripetal Velocity', 'Centripetal Acceleration', 'Tension in String', 'Period', 'Frequency'],
                    'Rotational-Motion': ['Angular Displacement', 'Angular Velocity', 'Angular Acceleration', 'Linear/Tangential Velocity', 'Linear/Tangential Acceleration'],
                    'Rotational-Dynamics': ['Torque', 'Moment of Inertia', 'Angular Momentum'],
                    "Newtons-2nd-Law": ['Dynamics Problem'],
                    'Momentum': ['Linear Momentum', 'Angular Momentum'],
                    'Work-and-Energy': ['Conservation of Energy', 'Work Energy Theorem'],
                    'Fluid-Mechanics': ['Properties of Fluids', 'Density', 'Pressure', 'Buoyant Forces', 'Apparent Weight', 'Continuity Equation', "Bernoulli's Equation"],
                    'Temperature-and-KT': ['Convert Between Scales', 'Ideal Gas Law', 'Thermal Expansion', 'Thermal Stress', "Newton's Law of Cooling", 'Relative Humidity', 'Diffusion', 'Kinetic Theory'],
                    'Heat': ['Internal Energy of an Ideal Gas', 'Specific Heat', 'Latent Heat', 'Conduction', 'Radiation'],
                    'Laws-of-Thermodynamics': ['First Law of Thermodynamics', 'Thermodynamic Processes', 'Work', 'Efficiency', 'Coefficient of Performance (COP)', 'Entropy and The Second Law of Thermodynamics']
                }
            }

            let htmlToReturn = ''
            topicsExtension[subject][topic].forEach((extension) => {
                htmlToReturn += `
                    <a class="topic-extension-item">${extension}</a>
                    <br>
                    <br>
                `
            })
            return htmlToReturn
        }
        static getTopicsExtension(subject, topic) {
            switch (subject) {
                case 'algebra':
                    switch (topic) {
                        case 'Basic Operations':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}"></div>
                            `
                        case 'Equations':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Logarithmic</a>
                                    <a class="dropdown-item" href="#">Exponential</a>
                                    <a class="dropdown-item" href="#">Linear</a>
                                    <a class="dropdown-item" href="#">Radical</a>
                                </div>
                            `
                        case 'Summation':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Double Summation</a>
                                    <a class="dropdown-item" href="#">Triple Summation</a>
                                </div>
                            `
                        case 'Pi (Product Notation)':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">

                                </div>
                            `
                        case 'Polynomials':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Properties</a>
                                    <a class="dropdown-item" href="#">Add</a>
                                    <a class="dropdown-item" href="#">Subtract</a>
                                    <a class="dropdown-item" href="#">Multiply</a>
                                    <a class="dropdown-item" href="#">Divide</a>
                                    <a class="dropdown-item" href="#">Factor</a>
                                    <a class="dropdown-item" href="#">LCM</a>
                                </div>
                            `
                        case 'Rational Expressions':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Add</a>
                                    <a class="dropdown-item" href="#">Subtract</a>
                                    <a class="dropdown-item" href="#">Multiply</a>
                                    <a class="dropdown-item" href="#">Reduce</a>
                                </div>
                            `
                    }
                    break
                case 'discreteMath':
                    switch (topic) {
                        case 'Propositional Logic':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">

                                </div>
                            `
                        case 'Rules of Inference':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">

                                </div>
                            `
                        case 'Set Theory':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Cartesian Product</a>
                                    <a class="dropdown-item" href="#">Power sets</a>
                                    <a class="dropdown-item" href="#">Union</a>
                                    <a class="dropdown-item" href="#">Intersection</a>
                                    <a class="dropdown-item" href="#">Difference</a>
                                    <a class="dropdown-item" href="#">Symmetric Difference</a>
                                    <a class="dropdown-item" href="#">Computer Representation</a>
                                </div>
                            `
                        case 'Induction':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">

                                </div>
                            `
                        case 'Number Theory':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Division Algorithm</a>
                                    <a class="dropdown-item" href="#">Euclidean Algorithm</a>
                                    <a class="dropdown-item" href="#">Modular Arithmetic</a>
                                    <a class="dropdown-item" href="#">Modular Exponentiation</a>
                                    <a class="dropdown-item" href="#">Congruences</a>
                                </div>
                            `
                        case 'Relations':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Properties</a>
                                    <a class="dropdown-item" href="#">Combining Relations</a>
                                </div>
                            `


                    }
                    break
                case 'calculus':
                    switch (topic) {
                        case 'Limits':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">One Variable</a>
                                    <a class="dropdown-item" href="#">Multi Variable</a>
                                    <a class="dropdown-item" href="#">One Sided</a>
                                    <a class="dropdown-item" href="#">At Infinity</a>
                                    <a class="dropdown-item" href="#">L'Hoptial's Rule</a>
                                    <a class="dropdown-item" href="#">Squeeze Theorem</a>
                                </div>
                            `
                        case 'Derivatives':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Sum/Diff Rule</a>
                                    <a class="dropdown-item" href="#">Product Rule</a>
                                    <a class="dropdown-item" href="#">Quotient Rule</a>
                                    <a class="dropdown-item" href="#">Chain Rule</a>
                                    <a class="dropdown-item" href="#">First Derivative</a>
                                    <a class="dropdown-item" href="#">Higher Order Derivatives</a>
                                    <a class="dropdown-item" href="#">Derivative At a Point</a>
                                    <a class="dropdown-item" href="#">Partial Derivative</a>
                                    <a class="dropdown-item" href="#">Implicit Derivative</a>
                                    <a class="dropdown-item" href="#">Second Implicit Derivative</a>
                                    <a class="dropdown-item" href="#">Derivative Using Definition</a>
                                </div>
                            `
                        case 'Derivative Applications':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Equation of Tangent Line</a>
                                    <a class="dropdown-item" href="#">Equation of Normal Line</a>
                                    <a class="dropdown-item" href="#">Extreme Points</a>
                                    <a class="dropdown-item" href="#">Linear Approximation</a>
                                    <a class="dropdown-item" href="#">Quadratic Approximation</a>
                                </div>
                            `
                        case 'Integrals':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Indefinite</a>
                                    <a class="dropdown-item" href="#">Definite</a>
                                    <a class="dropdown-item" href="#">Improper</a>
                                    <a class="dropdown-item" href="#">Double Integrals</a>
                                    <a class="dropdown-item" href="#">Triple Integrals</a>
                                </div>
                            `
                        case 'Integral Applications':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Limit of Sum</a>
                                    <a class="dropdown-item" href="#">Area Under Curve</a>
                                    <a class="dropdown-item" href="#">Area Between Curves</a>
                                    <a class="dropdown-item" href="#">Volume of Solid of Revolution</a>
                                    <a class="dropdown-item" href="#">Function Average</a>
                                    <a class="dropdown-item" href="#">Arc Length</a>
                                </div>
                            `
                    }
                    break
                case 'probability':
                    switch (topic) {
                        case 'Combinations':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">

                                </div>
                            `
                        case 'Permutations':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">

                                </div>
                            `
                    }
                    break
                case 'physics':
                    switch (topic) {
                        case 'Kinematics':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">ID Kinematics</a>
                                    <a class="dropdown-item" href="#">2D Kinematics</a>
                                </div>
                            `
                        case 'Circular Motion':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Centripetal Force</a>
                                    <a class="dropdown-item" href="#">Centripetal Velocity</a>
                                    <a class="dropdown-item" href="#">Centripetal Acceleration</a>
                                    <a class="dropdown-item" href="#">Tension in String</a>
                                    <a class="dropdown-item" href="#">Period</a>
                                    <a class="dropdown-item" href="#">Frequency</a>
                                </div>
                            `
                        case 'Rotational Motion':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Angular Displacement</a>
                                    <a class="dropdown-item" href="#">Angular Velocity</a>
                                    <a class="dropdown-item" href="#">Angular Acceleration</a>
                                    <a class="dropdown-item" href="#">Linear/Tangental Velocity</a>
                                    <a class="dropdown-item" href="#">Linear/Tangental/ Acceleration</a>
                                </div>
                            `
                        case 'Rotational Dynamics':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Torque</a>
                                    <a class="dropdown-item" href="#">Moment of Inertia</a>
                                    <a class="dropdown-item" href="#">Angular Momentum</a>
                                </div>
                            `
                        case "Newton's 2nd Law":
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Dynamics Problem</a>
                                </div>
                            `
                        case 'Momentum':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Linear Momentum</a>
                                    <a class="dropdown-item" href="#">Angular Momentum</a>
                                </div>
                            `
                        case 'Work and Energy':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Conservation of Energy</a>
                                    <a class="dropdown-item" href="#">Work Energy Theorem</a>
                                </div>
                            `
                        case 'Fluid Mechanics':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Properties of Fluids</a>
                                    <a class="dropdown-item" href="#">Density</a>
                                    <a class="dropdown-item" href="#">Pressure</a>
                                    <a class="dropdown-item" href="#">Buoyant Forces</a>
                                    <a class="dropdown-item" href="#">Apparent Weight</a>
                                    <a class="dropdown-item" href="#">Continuity Equation</a>
                                    <a class="dropdown-item" href="#">Bernoulli's Equation</a>
                                </div>
                            `
                        case 'Temperature and KT':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Convert Between Scales</a>
                                    <a class="dropdown-item" href="#">Ideal Gas Law</a>
                                    <a class="dropdown-item" href="#">Thermal Expansion</a>
                                    <a class="dropdown-item" href="#">Thermal Stress</a>
                                    <a class="dropdown-item" href="#">Newton's Law of Cooling</a>
                                    <a class="dropdown-item" href="#">Relative Humidity</a>
                                    <a class="dropdown-item" href="#">Diffusion</a>
                                    <a class="dropdown-item" href="#">Kinetic Theory</a>
                                </div>
                            `
                        case 'Heat':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">Internal Energy of an Ideal Gas</a>
                                    <a class="dropdown-item" href="#">Specific Heat</a>
                                    <a class="dropdown-item" href="#">Latent Heat</a>
                                    <a class="dropdown-item" href="#">Conduction</a>
                                    <a class="dropdown-item" href="#">Radiation</a>
                                    <a class="dropdown-item" href="#">Squeeze Theorem</a>
                                </div>
                            `
                        case 'Laws of Thermodynamics':
                            return `
                                <div style="background-color: #e0dddd" class="dropdown-menu" aria-labelledby="${topic}">
                                    <a class="dropdown-item" href="#">First Law of Theromodynamics</a>
                                    <a class="dropdown-item" href="#">Thermodynamic Processes</a>
                                    <a class="dropdown-item" href="#">Work</a>
                                    <a class="dropdown-item" href="#">Efficiency</a>
                                    <a class="dropdown-item" href="#">Coefficient of Performance (COP)</a>
                                    <a class="dropdown-item" href="#">Entropy and The Second Law of Thermodynamics</a>
                                </div>
                            `

                    }


            }
            return ''

        }
        static getSubjectOptions() {
            return {
                'algebra': ['Basic-Operations', 'Equations', 'Summation', 'Pi-Product-Notation', 'Polynomials', 'Rational-Expressions'],
                'discreteMath': ['Propositional-Logic', 'Set-Theory', 'Induction', 'Number-Theory', 'Relations'],
                'calculus': ['Limits', 'Derivatives', 'Derivative-Applications', 'Integrals', 'Integral-Applications'],
                'probability': ['Distributions', 'Expected Value', 'Variance', "Bayes Theorem", 'Combinations', 'Permutations'],
                'physics': ['Kinematics', 'Circular-Motion', 'Rotational-Motion', 'Rotational-Dynamics', "Newtons-2nd-Law", 'Momentum', 'Work-and-Energy', 'Fluid-Mechanics', 'Temperature-and-KT', 'Heat', 'Laws-of-Thermodynamics'],
            }
        }
    }
    class Animations {
        static animateShowSteps(stepContainer) {
            // stepContainer.style.display = 'block'
            stepContainer.overflow = 'auto'
            stepContainer.style.animationName = 'stepExpanded'
            stepContainer.style.animationDuration = '0.5s'
            stepContainer.style.animationFillMode = 'forwards'
            stepContainer.dataset.expanded = 'true'

            stepContainer.addEventListener('animationend', () => {
                // stepContainer.overflow = 'auto'
                // stepContainer.style.display = 'block'
            })
        }
        static animateHideSteps(stepContainer) {
            stepContainer.style.animationName = 'stepCollapsed'
            stepContainer.style.animationDuration = '0.5s'
            stepContainer.style.animationFillMode = 'forwards'
            stepContainer.dataset.expanded = 'false'

            stepContainer.addEventListener('animationend', () => {
                // stepContainer.style.overflow = 'hidden'
            })
        }
        static animateShowAllSteps() {
            const resultsContainer = document.querySelector('.results-container');
            resultsContainer.style.animationName = 'showAllSteps';
            resultsContainer.style.animationDuration = '3s';
            resultsContainer.style.animationFillMode = 'forwards';
            resultsContainer.animationDelay = '2s';

            resultsContainer.addEventListener('animationend', () => {
                this.reset_animation();
            })
        }
        static reset_animation() {
          var el = document.querySelector('.results-container');
          el.style.animation = 'none';
          el.offsetHeight; /* trigger reflow */
          el.style.animation = null; 
        }
    }
    class Storage {
        static instantiateStorage() {
            if (!(localStorage.getItem('last-solution'))) {
                localStorage.setItem('last-solution', 'empty')
            }

        }
        static reloadSolution(answerMathField) {
            const SU = new StepsUI();
            this.instantiateStorage();
            let lastSolution = localStorage.getItem('last-solution');

            if (lastSolution !== 'empty') {
                lastSolution = JSON.parse(lastSolution);
                let enteredMath = lastSolution['enteredMath'];
                answerMathField.write(enteredMath);
                SU.addStepsToDOM(enteredMath, true, false, false);
            }
        }
        static addLastSolution(solution) {
            this.instantiateStorage();
            localStorage.setItem('last-solution', JSON.stringify(solution));
        }
        static clear() {
            localStorage.setItem('last-solution', 'empty');
        }
    }


    document.addEventListener('DOMContentLoaded', () => {
        var MQ = MathQuill.getInterface(2)
        var config = {
            spaceBehavesLikeTab: false,
            leftRightIntoCmdGoes: 'up',
            restrictMismatchedBrackets: true,
            sumStartsWithNEquals: true,
            supSubsRequireOperand: true,
            charsThatBreakOutOfSupSub: '=',
            autoSubscriptNumerals: true,
            autoCommands: 'pi theta sqrt sum int phi omega rho alpha beta',
            autoOperatorNames: 'sin cos tan sinh cosh tanh arcsin arccos arctan ln log csc sec cot',
            maxDepth: 10,
        }

        var userInput = document.getElementById('userInput');

        var answerMathField = MQ.MathField(userInput, config, {
            handlers: {
                edit: function() {},
                upOutOf: function(mathField) {},
                moveOutOf: function(dir, mathField) {
                    if (dir === MQ.L) {

                    }
                    else {

                    }
                },
                enter: function () {
                    alert('enter')
                }
            }
        });

        
        if (performance.navigation.type == performance.navigation.TYPE_RELOAD) { // Page reloaded
          // Storage.reloadSolution(answerMathField)
        }
        else {
            // console.log('not reloaded')
            // Storage.clear()
        }
        Storage.reloadSolution(answerMathField)

        checkIfUserIsStillLoggedIn()
        BaseUI.loadSymbolsContainer()
        Animations.animateShowAllSteps()
        


    })


    // Subject Tabs - onclick
    document.querySelector('.subject-tabs').addEventListener('click', (e) => {
        if (e.target.classList.contains('subject-tab-btn')) {
            let subject = e.target.textContent
            let routes = {
                'Algebra': '/algebra',
                'Discrete Math': '/discrete_math',
                'Calculus': '/calculus',
                'Probability': '/probability',
                'Physics': '/physics',
            }
            Storage.clear()
            window.location.href = routes[subject]
            // subjectTabsUI.subjectTabBtnSelected(e.target)
            // console.log('after')

        }
    })
    // Topic Extension Item
    document.querySelector('#sidebar').addEventListener('click', (e) => {
        if (e.target.classList.contains('topics-btn')) {
            let pm = ''
            if (e.target.textContent.includes('+')) {
                e.target.style.ariaExpanded = 'true'
                pm = '-'
                e.target.innerHTML = e.target.innerHTML.replace('+', pm)
            }
            else {
                e.target.style. ariaExpanded = 'false'
                pm = '+'
                e.target.innerHTML = e.target.innerHTML.replace('-', pm)
            }

            let mainTopic = e.target.textContent
            mainTopic = replaceAll(replaceAll(mainTopic.trim(), '\\n', ''), `${pm} `, '')
            BaseUI.extensionTopicClicked(mainTopic, '')
        }
        if (e.target.className === 'topic-extension-item') {
            let extensionTopic = e.target.textContent
            let mainTopic = e.target.parentElement.parentElement.parentElement.previousElementSibling.textContent
            mainTopic = replaceAll(replaceAll(mainTopic.trim(), '\\n', ''), '+ ', '')
            BaseUI.extensionTopicClicked(mainTopic, extensionTopic)
        }
    })


    /* ON-CLICK EVENTS */
    document.querySelector('#skyRatingsHeaderBtn').addEventListener('click', () => {
        Storage.clear()
    })

    /* ON-HOVER EVENTS */

    // Subject Tabs
    document.querySelector('.subject-tabs').addEventListener('mouseover', (e) => {
        let subjectOptionsDiv = document.querySelector('.subject-topics')

        if (e.target.classList.contains('subject-tab-btn')) {
            let btnObj = e.target
            let btnSubjectPos = {
                'algebra': '275px',
                'discreteMath': '340px',
                'calculus': '455px',
                'probability': '535px',
                'physics': '625px',
            }
            let subjectOptions = subjectTabsUI.getSubjectOptions()

            switch (btnObj.textContent) {
                case "Algebra":
                    subjectOptionsDiv.style.left = btnSubjectPos['algebra']
                    subjectTabsUI.populateSubjectOptions(subjectOptions['algebra'])
                    break
                case "Discrete Math":
                    subjectOptionsDiv.style.left = btnSubjectPos['discreteMath']
                    subjectTabsUI.populateSubjectOptions(subjectOptions['discreteMath'])
                    break
                case "Calculus":
                    subjectOptionsDiv.style.left = btnSubjectPos['calculus']
                    subjectTabsUI.populateSubjectOptions(subjectOptions['calculus'])
                    break
                case "Probability":
                    subjectOptionsDiv.style.left = btnSubjectPos['probability']
                    subjectTabsUI.populateSubjectOptions(subjectOptions['probability'])
                    break
                case "Physics":
                    subjectOptionsDiv.style.left = btnSubjectPos['physics']
                    subjectTabsUI.populateSubjectOptions(subjectOptions['physics'])
                    break

            }
        }
    })
    // Container-1
    document.querySelector('.heading-container').addEventListener('mouseover', (e) => {
        if (e.target.classList.contains('subject-option-btn') || e.target.classList.contains('subject-tab-btn') || e.target.className === 'subject-topics') {
            subjectTabsUI.showSubjectTopics()
        }
        else {
            subjectTabsUI.removeSubjectTopics()
        }
    })



    function extractAllSimplificationsFromSolution(solution) {
        let allSimplifications = {}
        let i = 1
        for (let stepNum in solution) {
            allSimplifications[stepNum] = solution[stepNum]['simplification']

        }
        return allSimplifications
    }
    function escapeRegExp(string) {
        return string.replace(/[.*+\-?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
    }
    function replaceAll(str, find, replace) {
        return str.replace(new RegExp(escapeRegExp(find), 'g'), replace);
    }

</script>

{% block script1 %}
{% endblock %}

{% endblock %}




</html>