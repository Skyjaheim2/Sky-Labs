{% extends "base.html" %}

{% block head %}
{% endblock %}

{% block style %}
<style>

    #mainHeading {
        text-align: center;
        font-family: 'Times New Roman', Times, serif;
        font-size: 35px;
        font-weight: bold;
    }
    #selectedSubjectTabHeading {
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 30px;
        font-weight: 400;
        /*margin-left: 20%;*/
        margin-bottom: 30px;
        margin-top: 20px;
    }
    #desmosGraph {
        margin: auto;
    }
    .inputLabel {
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 18px;
        font-weight: 500;
    }
    .subject-tabs {
        height: 55px;
        background-color: #393737;
        margin-top: 80px;
        margin-bottom: 0;
        padding-left: 19.4%;
    }
    .subject-tab-btn {
        border-radius: 15px;
        height: 50px;
    }
    .subject-topics {
        display: none;
        font-family: "Times New Roman", Symbola, serif;
        position: absolute;
        background-color: white;
        left: 275px;
        height: auto;
        width: 410px;
        /*width: auto;*/
        border: 1px solid #c7c7c7;
    }
    .subject-option-btn {
        width: 200px;
        margin: 2px;


    }
    .btn-secondary {
        position: relative;
        margin-top: 5px;
        font-family: "Times New Roman", Symbola, serif;
        background-color: #393737;
        border: none;
    }
    .symbols-container {
        background-color: #e0dddd;
        border-radius: 10px;
        height: 150px;
        margin-bottom: 20px;
        margin-top: 10px;
    }
    #sidebar {
        border-radius: 10px;
        background-color: #e0dddd;
        /*position: absolute;*/
        /*top: 32%;*/

    }
    .topics-btn {
        /*width: 200px;*/
        font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman',serif;
        /*font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;*/
        padding: 5px 10px;
        margin-left: 10px;
        margin-right: 10px;
        border: none;
        /*border-top: 1px solid darkgray;*/
        font-size: 15px;
        background-color: #e0dddd;

    }
    .extension-topics-container {
        background-color: #e0dddd;
    }
    .symbol-btn {
        margin: 5px;
    }
    .topic-extension-item {
        text-decoration: none;
        color: black;
        cursor: pointer;
    }
    .topic-extension-item:hover {
        color: black;
    }
    .topic-extension-heading {
        font-family: "Times New Roman", Symbola, serif;
        color: #848484;
        /*font-weight: 0;*/
        /*font-size: 30px;*/
        /*font-weight: 350;*/
    }
    .heading-container {
        width: 100%;
    }
    .subject-heading-container {
        width: 100%;
        margin-left: 10px;
    }
    .sidebar-container {
        margin-left: 10px;
        /*padding: 10px;*/

    }
    .container-1 {
        display: flex;
        flex-wrap: wrap;
    }
    .container-2 {
        margin-left: 5%;
        width: 805px;

    }
    .sf-container {
        display: flex;
    }
    .suggestions-container {
        display: none;
        position: absolute;
        background: white;
        box-shadow: 0 0 2px 2px rgba(0, 0, 0, 0.5);
        border-radius: 10px;
        padding: 10px;
        height: auto;
        width: 800px;
        z-index: 1000;
    }
    .suggestion-item {
        cursor: pointer;
        height: auto;
        font-size: 17px;
    }
    /* STEPS */
    .main-container {
        /*margin-left: 20%;*/
        /*margin-right: 20%;*/
    }
    .results-container {
       /* animation-name: showAllSteps;
        animation-delay: 0.5s;
        animation-duration: 2s;
        animation-fill-mode: forwards;*/
        /*display: none;*/
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 15px;
        background-color: rgba(226, 226, 226, 0.45);
        border-radius: 15px;
        padding: 20px;
        /*height: 0;*/
        overflow-y: hidden;
    }
    .examples-container {
        background-color: rgba(226, 226, 226, 0.45);
        padding: 20px;
        border-radius: 15px;
        margin-top: 20px;
        height: auto;
    }
    .example-items-container {
        font-size: 17px;
        background-color: white;
        padding: 10px;
        border-radius: 10px;
        height: auto;
    }
    .example-item {
        cursor: pointer;
    }
    #examplesHeading {
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 20px;
        margin-bottom: 10px;
    }
    #finalSolutionHeading {
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 17px;
        margin-bottom: 20px;
        overflow-y: hidden;
        overflow-x: auto;
    }
    .final-result {
        font-size: 20px;
    }
    .steps-heading {
        display: none;
        margin-top: 10px;
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 25px;
        font-weight: 600;
    }
    .steps-container {
        background-color: white;
        padding: 10px;
        border-radius: 10px;
        /*height: 400px;*/
    }
    .step-description {
        background-color: rgba(226, 226, 226, 0.45);
        /*font-family: "Times New Roman", Symbola, serif;*/
        /*font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;*/
        font-size: 15px;
        padding: 5px;
        border-radius: 10px;
        margin-bottom: 8px;
        /*margin-top: 50px;*/
    }
    .katex {
        /*font-family: "Times New Roman", Symbola, serif;*/
        /*font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;*/
        font-family: 'Computer Modern',serif;
    }
    .expandable-step-container {
        background-color: rgba(215, 213, 213, 0.45);
        font-family: "Times New Roman", Symbola, serif;
        font-size: 17px;
        padding: 7px;
        border-radius: 10px;
        margin-top: 0;
        margin-bottom: 0;
        overflow-x: hidden;

    }
    .show-steps-span {
        font-family: "Times New Roman", Symbola, serif;
        font-size: 16px;
        float: right;
        cursor: pointer;
    }
    .show-steps-icon {
        width: 25px;
        height: 25px;
    }
    .expanded-step-heading {
        font-size: 16px;
        margin-top: 11px;
    }
    .expandable-step-solution-container {
        /*animation-name: stepExpanded;*/
        /*animation-delay: 0.5s;*/
        /*animation-duration: 1s;*/
        /*animation-fill-mode: forwards;*/
        /*display: none;*/
        overflow: hidden;
        border-radius: 10px;
        margin-top: 3px;
        margin-bottom: 3px;
        height: 0;
    }
    .step-info {
        font-size: 17px;
        margin-top: 11px;
        margin-bottom: 15px;
        overflow-y: hidden;
        overflow-x: auto;
        /*overflow-y: visible;*/
        /*height: 50px;*/
        white-space: nowrap;
    }
    .final-step {
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 17px;
        font-weight: 600;
        margin-top: 10px;
        overflow-y: visible;
        /*overflow-x: auto;*/
    }
    @keyframes stepExpanded {
        from {
            height: 0;
            padding: 0;
            box-shadow: none;
        }
        to {
            height: 300px;
            padding: 10px;
            box-shadow: 0 0 3px 3px rgba(0, 0, 0, 0.5);
        }

    }
    @keyframes stepCollapsed {
        from {
            height: 300px;
            padding: 10px;
            box-shadow: 0 0 3px 3px rgba(0, 0, 0, 0.5);
        }
        to {
            height: 0;
            padding: 0;
            box-shadow: none;
            /*padding-top: 40px;*/
        }
    }
    @keyframes showAllSteps {
        0% {
            max-height: 0;
          }

          100% {
            max-height: 2000px;
          }
    }
</style>

{% block style1 %}
{% endblock %}

{% endblock %}


{% block heading_items %}
    <div class="subject-tabs">  
        <div class="btn-group">
            <button id="algebraSubjectTabBtn" class="btn btn-secondary subject-tab-btn" data-subject="Algebra">Algebra</button>
            <button id="discreteMathSubjectTabBtn" class="btn btn-secondary subject-tab-btn" data-subject="Discrete Math">Discrete Math</button>
            <button id="calculusSubjectTabBtn" class="btn btn-secondary subject-tab-btn" data-subject="Calculus">Calculus</button>
            <button id="probabilitySubjectTabBtn" class="btn btn-secondary subject-tab-btn" data-subject="Probability">Probability</button>
            <button id="physicsSubjectTabBtn" class="btn btn-secondary subject-tab-btn" data-subject="Physics">Physics</button>
        </div>
    </div>  

    <div class="subject-topics"></div>

{% endblock %}

{% block body %}
    <div class="subject-heading-container">
        <div id="selectedSubjectTabHeading"></div>
    </div>

    <div class="sidebar-container">
        <div id="sidebar"></div>
    </div>

    <div class="container-2">
        <div class="symbols-container"></div>

        <div class="main-container">
            {% block subject_features %}
            {% endblock %}

            <div class="results-container">


                <div id="finalSolutionHeading"></div>
                <div class="steps-heading">Steps</div>
                <div class="steps-container"></div>

            </div>

            <div class="examples-container">
                <div id="examplesHeading">Examples</div>
                <div class="example-items-container">
<!--                    <div class="example-item">-->
<!--                        $ 5x^2+3x^2+x+3 $-->
<!--                    </div>-->
<!--                    <hr>-->
<!--                    <div class="example-item">-->
<!--                        $ 36x^3+3x^2+5x+1 $-->
<!--                    </div>-->
<!--                    <hr>-->
<!--                    <div class="example-item">-->
<!--                        $ \displaystyle \sum_{n=0}^\infty \cfrac{x^{4n+2}}{(4n+2)!} $-->
<!--                    </div>-->
<!--                    <hr>-->
<!--                    <div class="example-item">-->
<!--                        $ \cfrac{\partial^2}{\partial x \partial t}\left( e^{3x}\sinh(25x+1) \right) $-->
<!--                    </div>-->
<!--                    <hr>-->
<!--                    <div class="example-item">-->
<!--                        $ \text{simplify}\ 19x^5+3x^3+5x^2+9x+1 $-->
<!--                    </div>-->
<!--                    <hr>-->
<!--                    <div class="example-item">-->
<!--                        $ \text{combine}\ \cfrac{1}{\sqrt{1-x^2}}+\cfrac{1}{1+x^2} $-->
<!--                    </div>-->
<!--                    <hr>-->
<!--                    <div class="example-item">-->
<!--                        $ \displaystyle \int \cfrac{1}{1+\sqrt{1-x^2}}dx $-->
<!--                    </div>-->
                    <hr>

                </div>

            </div>
        </div>

    </div>  
{% endblock %}


{% block script %}

<script>

    // let e_steps_count = 1
    class StepsUI {
        constructor() {
            this.main_steps_count = 1;
            this.e_steps_count = 1;
        }

        static displayResult(resultText) {
            let resultContainer = document.querySelector('.results-container')
            let resultDiv = document.createElement('div')
            resultDiv.textContent = resultText
            resultContainer.appendChild(resultDiv)
        }
        displayStep(container, step, type, e_step_id) {
            e_step_id = this.e_steps_count
            // console.log(foo)
            // console.log(num_e_steps_added)
            if (type === 'main-step') {
                container.innerHTML += `
                    <div class="step-description">${step['description']}</div>
                    <div class="step-info">${step['info']}</div>
                `
            }
            else if (type === 'e-step') {
                this.e_steps_count += 1

                container.innerHTML += `<div id="e-step-${e_step_id}" class="expandable-step-container"><span class="expandable-step">${step['heading']}</span><span class="show-steps-span">Show Steps <img class="show-steps-icon" src="{{ url_for('static', filename='img/add.svg') }}"></span></div>`
                let e_stepSolutionContainer = document.createElement('div')
                e_stepSolutionContainer.id = `e-step-solution-${e_step_id}`
                e_stepSolutionContainer.className = 'expandable-step-solution-container'
                e_stepSolutionContainer.dataset.expanded = 'false'

                e_stepSolutionContainer.innerHTML += `<div class="expanded-step-heading">${step['heading'].split('=')[0]}</div>`
                e_stepSolutionContainer.innerHTML += `<hr>`

                let e_Steps = step['e-steps']
                e_Steps.forEach((e_step) => {
                    if (e_step['type'] === 'main-step') {
                        this.displayStep(e_stepSolutionContainer, e_step, 'main-step', e_step_id)
                    }
                    else if (e_step['type'] === 'e-step') {
                        // let num_e_steps_added = document.querySelectorAll('.expandable-step-container')
                        // console.log(num_e_steps_added)

                        this.displayStep(e_stepSolutionContainer, e_step, 'e-step', e_step_id+1)
                    }
                })
                container.appendChild(e_stepSolutionContainer)

            }

        }
        static displayStepsHeading() {
            let stepsHeading = document.querySelector('.steps-heading')
            stepsHeading.style.display = 'block'
        }
        static addLatexToSteps(finalResult, enteredMath) {
            // Add Latex to all .step-descriptions
            document.querySelectorAll('.step-description').forEach((description) => {
                StepsUI.addLatexToElement(description, description.textContent)
            })
            // Add Latex to all .step-info
            document.querySelectorAll('.step-info').forEach((info) => {
                StepsUI.addLatexToElement(info, info.textContent)
            })
            // Add Latex to all .expandable-step
            document.querySelectorAll('.expandable-step').forEach((step) => {
                StepsUI.addLatexToElement(step, step.textContent)
            })
            // Add Latex to all .expandable-step-solution-container
            document.querySelectorAll('.expandable-step-solution-container').forEach((container) => {
                // StepsUI.addLatexToElement(container, container.textContent)
            })
            // Add Latex to all .expanded-step-heading
            document.querySelectorAll('.expanded-step-heading').forEach((heading) => {
                StepsUI.addLatexToElement(heading, heading.textContent)
            })
            // Add latex to .final-step
            StepsUI.addLatexToElement(document.querySelector('.final-step'), `\\displaystyle \\text{Solution:}\\ ${finalResult.replace('diverges', '\\text{diverges}')}`)
            /* Add Latex To Solution Heading */

            // Check for keyword
            const allKeywords = ['simplify', 'combine', 'expand', 'graph'];
            let keyword;
            let userInput;
            let inputItems = enteredMath.split(' ');
            if (allKeywords.includes(inputItems[0].replaceAll('\\', ''))) {
                keyword = inputItems[0].replaceAll('\\', '');
                userInput = '';
                inputItems.splice(1).forEach((item) => {
                    if (item.slice(-4) === 'cdot') item = `${item} ` // replace \cdotx with \cdot x
                    userInput += item;
                })
            }
            else {
                userInput = enteredMath;
            }
            // console.log(`{\\displaystyle ${userInput}=${finalResult}}`)
            StepsUI.addLatexToElement(document.querySelector('#finalSolutionHeading'), `{\\displaystyle ${userInput}=${finalResult.replace('diverges', '\\text{diverges}')}}`)

        }
        static makeStepsExpandable() {
            let numExpandableSteps = document.querySelectorAll('.expandable-step-container').length

            for (let i = 1; i <= numExpandableSteps; i++) {
                document.querySelector(`#e-step-${i}`).addEventListener('click', (e) => {
                    let stepContainer = document.querySelector(`#e-step-solution-${i}`)
                    if (e.target.className === 'show-steps-span') {
                        if (stepContainer.dataset.expanded === 'false') {
                            e.target.innerHTML = `Hide Steps <img class="show-steps-icon" src="{{ url_for('static', filename='img/minus.svg') }}">`
                            stepContainer.style.overflow = 'auto'
                            Animations.animateShowSteps(stepContainer)
                        }
                        else {
                            e.target.innerHTML = `Show Steps <img class="show-steps-icon" src="{{ url_for('static', filename='img/add.svg') }}">`
                            Animations.animateHideSteps(stepContainer)
                            $(stepContainer).animate({scrollTop: 0}, "fast");
                            stepContainer.style.overflow = 'hidden'
                        }

                    }
                    
                })
            }
        }
        static addLatexToElement(element, latexString) {
            katex.render(String.raw`${latexString}`, element, {
                throwOnError: false
            });
        }
        static showAllSteps(solution, enteredExpression) {
            let stepsContainer = document.querySelector('.steps-container')
            let allSimplifications = extractAllSimplificationsFromSolution(solution)
            let stepCounter = 1

            /* Clear any previous steps */
            stepsContainer.innerHTML = ''

            for (let stepNum in solution) {
                let currentStep = new Step(solution[stepNum])


                if (!(currentStep.isFinalStep)) {
                    let latexStepDescriptionSpan = document.createElement('span')
                    let latexStepInfoSpan = document.createElement('span')

                    /* Create step description */
                    let stepDescriptionDiv = document.createElement('div')
                    stepDescriptionDiv.className = 'step-description'
                    stepDescriptionDiv.textContent = `${currentStep.description}: `
                    stepDescriptionDiv.appendChild(latexStepDescriptionSpan)
                    /* Create step info */
                    let stepInfoDiv = document.createElement('div')
                    stepInfoDiv.className = 'step-info'
                    stepInfoDiv.appendChild(latexStepInfoSpan)

                    /* Add step description and step info to stepsContainer */
                    stepsContainer.appendChild(stepDescriptionDiv)
                    stepsContainer.appendChild(stepInfoDiv)


                    /* Add latex */
                    StepsUI.addLatexToElement(latexStepDescriptionSpan, currentStep.result)
                    if (stepCounter === 1) {
                        StepsUI.addLatexToElement(latexStepInfoSpan, `${enteredExpression} = ${currentStep.simplification}`)
                    }
                    else {
                        /* Show the the previous simplification for currentStep step-info */
                        StepsUI.addLatexToElement(latexStepInfoSpan, `${allSimplifications[stepCounter-1]} = ${allSimplifications[stepNum]}`)
                    }

                }
                else {
                    let lastStepInfoDiv = stepsContainer.lastElementChild
                    lastStepInfoDiv.className = 'final-step'
                    lastStepInfoDiv.textContent = 'Solution: '

                    let latexFinalStepSpan = document.createElement('span')

                    lastStepInfoDiv.appendChild(latexFinalStepSpan)

                    StepsUI.addLatexToElement(latexFinalStepSpan, solution[stepCounter])

                }
                stepCounter += 1
            }

        }
        static getUserInput() {
            return document.querySelector('#userInput').value
        }
        static addGraphElementToDOM() {
            const resultsContainer = document.querySelector('.results-container');
            const desmosGraph = document.createElement('div');
            desmosGraph.id = 'desmosGraph';
            desmosGraph.style.display = 'none';
            desmosGraph.style.width = '750px';
            desmosGraph.style.height = '400px';
            resultsContainer.appendChild(desmosGraph);
        }
        addStepsToDOM(enteredMath, requestFromHistory, liveSolve, addSolutionToLS, subject) {
            const selectedTopic = LayoutUI.getSelectedTopic();
            const resultsContainer = document.querySelector('.results-container');
            // Clear previous work
            resultsContainer.innerHTML = `
                <div id="finalSolutionHeading"></div>
                <div class="steps-heading">Steps</div>
                <div class="steps-container"></div>
            `;

            StepsUI.addGraphElementToDOM();
            var graphElement = document.getElementById('desmosGraph');
            var desmosGraph = Desmos.GraphingCalculator(graphElement, {
                'lockViewport': false,
                'expressions': true, // Show list of expressions on the side
                'expressionsCollapsed': true,
                'settingsMenu': true,
                'keypad': false
            });

            const request = new XMLHttpRequest();
            request.open('POST', `/solve/${requestFromHistory}/${liveSolve}`);
            request.onload = () => {
                if (request.status === 200) {
                    let response = request.responseText;
                    response = JSON.parse(response);
                    if (response.message === 'graph') {

                        graphElement.style.display = 'block';
                        const functionToGraph = response.content.functionToGraph;

                        desmosGraph.setExpression({id: 'graph1', latex: `${functionToGraph}`});

                        if (addSolutionToLS) {
                            let solution = {'finalResult': `${enteredMath}`, 'steps': [], 'enteredMath': `${enteredMath}`};
                            solution['enteredMath'] = enteredMath;
                            Storage.addLastSolution(solution);
                            Storage.addLastSubject(subject.toLowerCase());
                        }
                        document.querySelector('.steps-container').style.display = 'none';
                        StepsUI.addLatexToElement(document.querySelector('#finalSolutionHeading'), `{\\displaystyle \\text{Graphing} \\ ${functionToGraph}}`)


                    }
                    else if (response.message === 'solved') {
                        let solution = response.content;
                        let Steps = solution['steps']
                        let finalResult = solution['finalResult']
                        let stepsContainer = document.querySelector('.steps-container')

                        let e_step_id = 1
                        Steps.forEach((step) => {
                            if (step['type'] === 'main-step') {
                                this.displayStep(stepsContainer, step, 'main-step')
                            } else if (step['type'] === 'e-step') {

                                this.displayStep(stepsContainer, step, 'e-step', e_step_id)
                                let num_e_steps_added = document.querySelectorAll('.expandable-step-container').length
                                e_step_id = num_e_steps_added + 1
                            }
                        })
                        stepsContainer.innerHTML += `<div class="final-step"></div>`

                        StepsUI.addLatexToSteps(finalResult, enteredMath)
                        StepsUI.makeStepsExpandable()

                        if (addSolutionToLS) {
                            solution['enteredMath'] = enteredMath;
                            Storage.addLastSolution(solution);
                            Storage.addLastSubject(subject.toLowerCase());
                        }

                        Animations.animateShowAllSteps()
                    }

                    else {
                        UI.showAlert('Unable To Solve', 'danger');
                    }
                }
                // document.querySelector('.results-container').style.height = '0'
            }
            const data = new FormData()
            const subjectAndTopic = {'subject': subject, 'topic': selectedTopic}

            data.set('userInput', enteredMath)
            data.set('subjectAndTopic', JSON.stringify(subjectAndTopic))
            request.send(data)
        }
    }
    class Step {
        constructor(stepDict) {
            if (typeof stepDict === 'object' && typeof stepDict !== null) {
                this.simplification = stepDict['simplification']
                this.step = stepDict['step']
                this.isFinalStep = false
                this.description = this.step.split(': ')[0]
                this.result = this.step.split(': ')[1]

            }
            else {
                this.simplification = stepDict
                this.step = stepDict
                this.isFinalStep = true
            }
        }
    }
    class LayoutUI {

        static loadDefaultOptions(defaultSubject) {
            // Load Default Subject Tab
            let defaultSubjectTabBtn = document.querySelector(`#${defaultSubject}SubjectTabBtn`)
            let subjectTopicsContainer = document.querySelector('.subject-topics')
            let subjectOptions = SubjectTabsUI.getSubjectTopics()

            subjectOptions[defaultSubject].forEach((topic) => {
                subjectTopicsContainer.innerHTML += `<button class="btn btn-light subject-option-btn">${topic}</button>`
            })
            SubjectTabsUI.subjectTabBtnSelected(defaultSubjectTabBtn)
        }
        static loadSymbolsContainer() {

            // <button className="btn btn-light symbol-btn">$ x^2 $</button>
            // <button className="btn btn-light symbol-btn">$ x^{\square} $</button>
            // <button className="btn btn-light symbol-btn">$ \frac{\square}{\square} $</button>

            let symbolsContainer = document.querySelector('.symbols-container')

            let symbolsToAdd = [
                {
                    'symbol': 'x^2',
                    'latex': '\\left( \\right)^2',
                },
                {
                    'symbol': 'x^{\\square}',
                    'latex': '\\left( \\right)^{}',
                },
                {
                    'symbol': '\\log_{\\square}',
                    'latex': '\\log_{}\\left( \\right)',
                },
                {
                    'symbol': '\\sqrt{\\square}',
                    'latex': '\\sqrt{}',
                },
                {
                    'symbol': '\\sqrt[\\square]{\\square}',
                    'latex': '\\sqrt[]{}'
                },
                {
                    'symbol': '\\leq',
                    'latex': '\\leq',
                },
                {
                    'symbol': '\\geq',
                    'latex': '\\geq',
                },
                {
                    'symbol': '\\frac{\\square}{\\square}',
                    'latex': '\\frac{}{}',
                },
                {
                    'symbol': '\\cdot',
                    'latex': '\\cdot',
                },
                {
                    'symbol': '\\div',
                    'latex': '\\div',
                },
                {
                    'symbol': 'x^{\\circ}',
                    'latex': '\\left( \\right)^{\\circ}',
                },
                {
                    'symbol': '\\pi',
                    'latex': '\\pi',
                },
                {
                    'symbol': "(\\square)'",
                    'latex': "\\left( \\right)'",
                },
                {
                    'symbol': '\\frac{d}{dx}',
                    'latex': '\\frac{d}{dx}\\left( \\right)',
                },
                {
                    'symbol': '\\frac{\\partial}{\\partial x}',
                    'latex': '\\frac{\\partial}{\\partial x}\\left( \\right)',
                },
                {
                    'symbol': '\\int',
                    'latex': '\\int',
                },
                {
                    'symbol': '\\iint',
                    'latex': '\\int \\int',
                },
                {
                    'symbol': '\\iiint',
                    'latex': '\\int \\int \\int',
                },
                {
                    'symbol': '\\int_{\\square}^{\\square}',
                    'latex': '\\int_{}^{}',
                },
                {
                    'symbol': '\\lim',
                    'latex': '\\lim_{x \\to 0}\\left( \\right)',
                },
                {
                    'symbol': '\\sum',
                    'latex': '\\sum_{n=1}\\left( \\right)',
                },
                {
                    'symbol': '\\infty',
                    'latex': '\\infty',
                },
                {
                    'symbol': '\\theta',
                    'latex': '\\theta',
                },
                {
                    'symbol': 'f(x)',
                    'latex': 'f(x)',
                },
                {
                    'symbol': '\\ln',
                    'latex': '\\ln\\left( \\right)',
                },
                {
                    'symbol': 'e^{\\square}',
                    'latex': 'e^{}',
                },
                {
                    'symbol': '\\sin',
                    'latex': '\\sin\\left( \\right)',
                },
                {
                    'symbol': '\\cos',
                    'latex': '\\cos\\left( \\right)',
                },
                {
                    'symbol': '\\tan',
                    'latex': '\\tan\\left( \\right)',
                },
                {
                    'symbol': '\\cot',
                    'latex': '\\cot\\left( \\right)',
                },
                {
                    'symbol': '\\csc',
                    'latex': '\\csc\\left( \\right)',
                },
                {
                    'symbol': '\\sec',
                    'latex': '\\sec\\left( \\right)',
                },
                {
                    'symbol': '\\sinh',
                    'latex': '\\sinh\\left( \\right)',
                },
                {
                    'symbol': '\\cosh',
                    'latex': '\\cosh\\left( \\right)',
                },
                {
                    'symbol': '\\tanh',
                    'latex': '\\tanh\\left( \\right)',
                },
                {
                    'symbol': '\\arcsin',
                    'latex': '\\arcsin\\left( \\right)',
                },
                {
                    'symbol': '\\arccos',
                    'latex': '\\arccos\\left( \\right)',
                },
                {
                    'symbol': '\\arctan',
                    'latex': '\\arctan\\left( \\right)',
                },

            ]

            symbolsToAdd.forEach((item) => {
                let symbol = item['symbol']
                let latex = item['latex']

                let symbolButton = document.createElement('button')
                symbolButton.className = 'btn btn-light symbol-btn'
                symbolButton.dataset.latex = latex

                symbolsContainer.appendChild(symbolButton)
                StepsUI.addLatexToElement(symbolButton, symbol)
            })
        }
        static loadExamples() {
            let examples = [];
            const exampleItemsContainer = document.querySelector('.example-items-container');
            const subject = document.querySelector('#selectedSubjectTabHeading').children[0].textContent;

            let mainTopic = document.querySelector('#selectedSubjectTabHeading').children[1].textContent.trim();
            let extensionTopic;
            if (mainTopic.includes('→')) {
                let splitTopics = mainTopic.split('→');
                mainTopic = splitTopics[0].replace('-', '').trim();
                extensionTopic = splitTopics[1];

            }
            else {
                extensionTopic = null;
            }
            // Clear prev examples
            exampleItemsContainer.innerHTML = '';

            examples = ApplicationContent.getExamples(subject, mainTopic.replaceAll(' ', ' '), extensionTopic);
            examples.forEach((example) => {

                let exampleItem = document.createElement('div');
                exampleItem.className = 'example-item';
                exampleItem.dataset.exampleContent = example;
                StepsUI.addLatexToElement(exampleItem, `\\displaystyle\\ ${example}`);
                exampleItemsContainer.appendChild(exampleItem);
                exampleItemsContainer.innerHTML += '<hr>';
            })
            // Add event listener
            document.querySelectorAll('.example-item').forEach((example) => {
                example.addEventListener('click', (e) => {
                    let exampleItem = e.target;
                    while (exampleItem.className !== 'example-item') {
                        exampleItem = exampleItem.parentElement;
                    }
                    let exampleContent = exampleItem.dataset.exampleContent;
                    if (exampleContent.includes('\\text')) {
                        let keyword = exampleContent.split(' ')[0].replaceAll('\\', '').replace('{', '').replace('}', '').replace('text', '')
                        let content = exampleContent.split(' ')[1]
                        exampleContent = `${keyword}\\ ${content}`
                    }
                    // Add steps to DOM
                    const SU = new StepsUI();
                    SU.addStepsToDOM(exampleContent, false, false, true, subject.toLowerCase());
                    // ADD EXPRESSION TO USER INPUT
                    // answerMathField.latex(exampleContent)
                    // Scroll to top
                    window.scroll({
                        top: 500,
                        left: 0,
                        behavior: 'smooth'
                    });

                })
            })

        }
        static extensionTopicClicked(mainTopic, extensionTopic) {
            let mainHeading = document.querySelector('#selectedSubjectTabHeading');
            let delimiter;
            if (extensionTopic !== '')
                delimiter = '→'
            else
                delimiter = ''

            if (mainHeading.innerHTML.includes('topic-extension-heading')) {
                let topicExtensionHeading = document.querySelector('.topic-extension-heading')
                topicExtensionHeading.innerHTML = `${mainTopic}${delimiter}${extensionTopic}`
            }
            else {
                mainHeading.innerHTML += `<span class="topic-extension-heading"> ${mainTopic}${delimiter}${extensionTopic}</span>`
            }


            // mainHeading.innerHTML += `<span class="topic-extension-heading"> ${mainTopic}→${extensionTopic}</span>`
        }
        static clickLastTopic() {
            const lastTopic = Storage.getLastTopicClicked();
            const allTopicBtn = document.querySelectorAll('.topics-btn');
            let btnClicked = false;
            if (lastTopic !== null) {
                allTopicBtn.forEach((btn) => {
                    let mainTopic = btn.textContent;
                    mainTopic = replaceAll(replaceAll(mainTopic.trim(), '\\n', ''), `+ `, '');
                    if (mainTopic === lastTopic) {
                        btn.click();
                        btnClicked = true;
                    }
                })
                if (!(btnClicked)) {
                    document.querySelector('.topics-btn').click() // Expand the first topic
                }

            }
            else {
                document.querySelector('.topics-btn').click() // Expand the first topic
            }
        }
        static getSelectedTopic() {
            let selectedSubjectHeading = document.querySelector('#selectedSubjectTabHeading')
            if (selectedSubjectHeading.children.length !== 0) {
                return selectedSubjectHeading.children[0].textContent.trim()
            }
            else {
                return selectedSubjectHeading.textContent
            }
        }


        
    }
    class SubjectTabsUI {
        static subjectTabBtnSelected(btnObj) {
            let subjectTabHeading = document.querySelector('#selectedSubjectTabHeading')
            let allBtnObjects = document.querySelectorAll('.subject-tab-btn')
            allBtnObjects.forEach((btn) => {
                if (btn !== btnObj) {
                    btn.style.backgroundColor = ''
                }
                else {
                    btn.style.backgroundColor = 'black'
                }
            })
            subjectTabHeading.innerHTML = `<span>${btnObj.textContent}</span>`
            // this.loadSideBarBtn(btnObj.dataset.subject)
            this.loadSideBarBtn2(btnObj.dataset.subject)
        }
        static showSubjectTopics() {
            let subjectOptionsContainer = document.querySelector('.subject-topics')
            subjectOptionsContainer.style.display = 'flex'
            subjectOptionsContainer.style.flexWrap = 'wrap'
        }
        static removeSubjectTopics() {
            let subjectOptionsContainer = document.querySelector('.subject-topics')
            subjectOptionsContainer.style.display = 'none'
        }
        static populateSubjectOptions(Topics) {
            let subjectOptionsDiv = document.querySelector('.subject-topics')

            let htmlToAdd = ''
            Topics.forEach((topic) => {
                htmlToAdd += `<button class="btn btn-light subject-option-btn">${topic}</button>`
            })
            subjectOptionsDiv.innerHTML = htmlToAdd
        }

        static loadSideBarBtn2(subject) {
            let sideBar = document.querySelector('#sidebar')
            let subjectTopicsContainer = document.querySelector('.subject-topics')

            let sideBarBtnHtml = ''

            subjectTopicsContainer.childNodes.forEach((btn) => {
                let topic = btn.textContent
                let extensionTopics = this.getTopicsExtensionHTML(subject, topic)

                let extendTopicsSymbol
                let extensionTopicsHtml

                if (extensionTopics.length === 124) {
                    extendTopicsSymbol = '&nbsp;&nbsp;'
                    extensionTopicsHtml = ''
                }
                else {
                    extendTopicsSymbol = '+'
                    extensionTopicsHtml = `
                        <div class="collapse" id="${topic}">
                            <div class="card card-body extension-topics-container">
                                <p style="font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
                                    font-size:small;">
                                    ${extensionTopics}
                                </p>
                            </div>
                        </div>
                    `
                }
                sideBarBtnHtml +=  `
                    <p>
                        <a class="btn btn-light topics-btn" data-toggle="collapse" href="#${topic}" role="button" aria-expanded="false" aria-controls="collapseExample"
                           style="">
                            ${extendTopicsSymbol}&nbsp; ${replaceAll(topic, '-', ' ')}
                        </a>
                    </p>
                    ${extensionTopicsHtml}
                `
            })
            sideBar.innerHTML = sideBarBtnHtml;
            setTimeout(() => {
                LayoutUI.clickLastTopic();
                LayoutUI.loadExamples();
            }, 1000)

        }
        static getTopicsExtensionHTML(subject, topic) {
            let topicsExtension = ApplicationContent.getTopicsExtension(subject, topic);

            let htmlToReturn = ''
            topicsExtension.forEach((extension) => {
                htmlToReturn += `
                    <a class="topic-extension-item">${extension}</a>
                    <br>
                    <br>
                `
            })
            return htmlToReturn
        }
        static getSubjectTopics() {
            return {
                'algebra': ['Basic-Operations', 'Equations', 'Summation', 'Pi-Product-Notation', 'Polynomials', 'Rational-Expressions'],
                'discreteMath': ['Propositional-Logic', 'Set-Theory', 'Induction', 'Number-Theory', 'Relations'],
                'calculus': ['Limits', 'Derivatives', 'Derivative-Applications', 'Integrals', 'Integral-Applications'],
                'probability': ['Distributions', 'Expected Value', 'Variance', "Bayes Theorem", 'Combinations', 'Permutations'],
                'physics': ['Kinematics', 'Circular-Motion', 'Rotational-Motion', 'Rotational-Dynamics', "Newtons-2nd-Law", 'Momentum', 'Work-and-Energy', 'Fluid-Mechanics', 'Temperature-and-KT', 'Heat', 'Laws-of-Thermodynamics'],
            }
        }
    }
    class Animations {
        static animateShowSteps(stepContainer) {
            // stepContainer.style.display = 'block'
            stepContainer.overflow = 'auto'
            stepContainer.style.animationName = 'stepExpanded'
            stepContainer.style.animationDuration = '0.5s'
            stepContainer.style.animationFillMode = 'forwards'
            stepContainer.dataset.expanded = 'true'

            stepContainer.addEventListener('animationend', () => {
                // stepContainer.overflow = 'auto'
                // stepContainer.style.display = 'block'
            })
        }
        static animateHideSteps(stepContainer) {
            stepContainer.style.animationName = 'stepCollapsed'
            stepContainer.style.animationDuration = '0.5s'
            stepContainer.style.animationFillMode = 'forwards'
            stepContainer.dataset.expanded = 'false'

            stepContainer.addEventListener('animationend', () => {
                // stepContainer.style.overflow = 'hidden'
            })
        }
        static animateShowAllSteps() {
            const resultsContainer = document.querySelector('.results-container');
            resultsContainer.style.animationName = 'showAllSteps';
            resultsContainer.style.animationDuration = '3s';
            resultsContainer.style.animationFillMode = 'forwards';
            resultsContainer.animationDelay = '2s';

            resultsContainer.addEventListener('animationend', () => {
                this.reset_animation();
            })
        }
        static reset_animation() {
          var el = document.querySelector('.results-container');
          el.style.animation = 'none';
          el.offsetHeight; /* trigger reflow */
          el.style.animation = null; 
        }
    }

    class ApplicationContent {
        static getExamples(subject, mainTopic, extensionTopic, getAll=false) {
            let examples = [];
            const allExtensionTopics = this.getTopicsExtension(subject, mainTopic.replaceAll(' ', '-'))
            if (extensionTopic === null) {
                /* IN THE CASE OF A null extensionTopic, THE EXAMPLES ARE GENERATED BY TAKING 2 RANDOM
                *  EXAMPLE FROM ALL THE AVAILABLE extensionTopics */
                allExtensionTopics.forEach((e_topic) => {
                    const e_topic_examples = this.getExamples(subject, mainTopic, e_topic);
                    if (e_topic_examples.length > 0) {
                        if (getAll) {
                            e_topic_examples.forEach((example) => {
                                examples.push(example)
                            })

                        }
                        else {
                            const randomExampleIndex = getRandomInt(e_topic_examples.length - 1);
                            examples.push(e_topic_examples[randomExampleIndex]);
                            examples.push(e_topic_examples[randomExampleIndex + 1]);
                        }

                    }
                })
                return examples
            }
            switch (subject) {
                case 'Algebra':
                    switch (mainTopic) {
                        case 'Basic Operations':
                            switch (extensionTopic) {
                                case 'Addition':
                                    examples = ['1+2+3+4', '23+19+6+8', '101+234+5+2', '51+23+19+6']
                                    break
                                case 'Subtraction':
                                    examples = ['24-56+19-20', '10-47+90-12+50', '-12-56-24-29', '30-102+15-10']
                                    break
                                case 'Multiplication':
                                    examples = ['23\\cdot19\\cdot 3', '32\\cdot10+15\\cdot3', '50\\cdot19', '4\\cdot 2\\cdot 19\\cdot 10']
                                    break
                                case 'Division':
                                    examples = ['\\frac{23+13}{19}', '\\frac{19+21+10-13}{12+20}', '\\frac{50}{51+23}+\\frac{13+25}{12+18}',
                                                '\\text{combine}\\\ \\frac{12+24+57}{23-56}+\\frac{23+15}{16}']
                                    break
                            }
                            break
                        case 'Equations':
                            switch (extensionTopic) {
                                case 'Linear':
                                    examples = ['5x+3=3', '12x+25x-34=5x+10', '50t-25t+20t=43+10t-1', '43t=10t-14'];
                                    break
                                case 'Quadratic':
                                    examples = ['x^{2}+3x=0', '3x^{2}+5x+19=10', 't^2+4t+4=0', 't^2+6t+5=0'];
                                    break
                                case 'Logarithmic':
                                    examples = ['\\ln\\left(5x+10\\right)=14', '\\ln\\left(25x^2+14x+10\\right)=\\ln\\left(10x^2+20x\\right)', '\\ln\\left(5x+10\\right)+\\ln\\left(13x+14\\right)=\\ln\\left(25x-10\\right)',
                                                '\\ln\\left((5x^2+13)^{2}\\right)=25', '\\ln\\left(19x^2-10x+5\\right)-\\ln\\left(5x+19\\right) = \\ln\\left(20x+14\\right)'];
                                    break
                                case 'Exponential':
                                    examples = ['e^{3x+10}=19', '2e^{5x^2+13x+9}=25', '2^{\\sqrt{5x+10}}=26', 'e^{19x^2+15x+19}=e^{23x+10}'];
                                    break
                            }
                            break
                        case 'Summation':
                            switch (extensionTopic) {
                                case 'Single Summation':
                                    examples = ['\\sum_{n=0}^{25}n', '\\sum_{n=0}^{50}n^2', '\\sum_{n=1}^{10}\\frac{1}{n^2}', '\\sum_{n=1}\\frac{n}{n+1}'];
                                    break
                                case 'Double Summation':
                                    examples = ['\\sum_{i=1}^{10}\\sum_{j=0}^{5}(3i+2j)', '\\sum_{s=1}^{10}\\sum_{t=1}^{5}\\frac{st}{s+t}',
                                                '\\sum_{u=0}^{25}\\sum_{v=0}^{10}\\left(u^{2}v+2uv+3v^{2}\\right)'];
                                    break
                            }

                            break
                        case 'Pi Product Notation':
                            switch (extensionTopic) {
                                case 'Single Product':
                                    examples = ['\\prod_{n=1}^{10}n', '\\prod_{n=1}^{15}(1+n^2)', '\\prod_{n=3}^{35}\\frac{1}{1+n^2}'];
                                    break
                                case 'Double Product':
                                    examples = ['\\prod_{i=1}^{10}\\prod_{j=1}^{25}(2ij+1)', '\\prod_{s=1}^{5}\\prod_{t=3}^{12}\\frac{st}{s^{2}+t^{2}}'];
                                    break
                            }
                            break
                        case 'Polynomials':
                            switch (extensionTopic) {
                                case 'Properties':
                                    examples = ['\\text{properties}\\\ f(x)=3x^2+2x^2+x+5', '\\text{properties}\\\ f(x)=x^2+3x+2',
                                                '\\text{properties}\\\ 5x^4+3x^2+9x-1', '\\text{properties}\\\ 6t^2+3t+9']
                                    break
                                case 'Add':
                                    examples = ['\\left(3x^2+5x+9\\right)+\\left(9x^2+7x-5\\right)', '\\left(5x^3+9x^2+3x\\right)+\\left(7x^2+3x+9\\right)', '\\left(4x^4+3x^2+9\\right)+\\left(9x^4+2x-1\\right)',
                                                '\\left(10x^2+13x+9\\right)+\\left(15x+23\\right)']
                                    break
                                case 'Subtract':
                                    examples = ['\\left(12x^2+13x+9\\right)-\\left(5x^2+9x-4\\right)', '\\left(14x^3+3x^2+4\\right)-\\left(7x^2+34x-10\\right)',
                                                '\\left(19x^2+13x-5\\right)-\\left(10x+9\\right)', '\\left(23x^2+19x+4\\right)-\\left(10x^2-19x-5\\right)']
                                    break
                                case 'Multiply':
                                    examples = ['\\left(4x+9\\right)\\left(3x-4\\right)', '\\left(x^2+4\\right)\\left(9x^2-6\\right)', '\\left(x^2-6x-9\\right)\\cdot\\left(15x^2+23x-4\\right)']
                                    break
                                case 'Divide':
                                    examples = ['\\text{long division}\\\ \\frac{x^2+3x+2}{4x-1}', '\\text{long division}\\\ \\frac{5x-9}{x^2+3x-4}',
                                                '\\text{long division}\\\ \\frac{x-1}{4x^2+3x-9}', '\\text{long division}\\\ \\frac{3x-1}{x^2-3x-4}']
                                    break
                                case 'Factor':
                                    examples = ['\\text{factor}\\\ x^2-4', '\\text{factor}\\\ x^2+3x+2', '\\text{factor}\\\ x^4-1',
                                                '\\text{factor}\\\ x^4+3x^2']
                                    break
                            }

                            break
                        case 'Rational Expressions':
                            switch (extensionTopic) {
                                case 'Add':
                                    examples = ['\\text{combine}\\ \\frac{5x+2x+3+6}{1+x+3x+9x}+\\frac{15y+13-7+21}{1+2y}',
                                                '\\text{combine}\\ \\frac{5x^3-2x^3+\\sqrt{13x+4x+1}}{1+3x^2+5x^2-6x^2}+\\frac{5x-2x}{1+x^2}'];
                                    break
                                case 'Subtract':
                                    examples = ['\\text{combine}\\ \\frac{15x^2+(5e^x-3e^x+(7x-2x+2+3))}{5+\\sqrt{9x+(3x+x)}-4}-\\frac{17x^2+2x^2+3}{1+x}',
                                                '\\text{combine}\\ \\frac{3x^2+5x+2x+1}{x^3+9x^3+4x-x+1}-\\frac{5x-x+1}{x+9}'];
                                    break
                                case 'Multiply':
                                    examples = ['\\frac{3x}{x+1}\\cdot\\frac{x}{5x+3}', '\\frac{2x}{7x^2+9}', '\\frac{x+1}{x^2+3x-4}\\cdot\\frac{3x+2}{x^2-5x+9}'];
                                    break
                                case 'Divide':
                                    examples = ['\\frac{\\frac{3x}{7}}{\\frac{9x}{2}}', '\\frac{\\frac{3x+7}{2}}{4x}', '\\frac{\\frac{5x+3x+4}{3x-4x+9}}{\\frac{9x^2+4x^{2}+1}{8x+18x-4+5}}'];
                                    break
                                case 'Reduce':
                                    examples = ['\\frac{x-3}{5x-15}', '\\frac{x^2+4x-45}{x^2+x-30}', '\\frac{\\left(z-8\\right)^2}{z^2-64}']
                            }
                            break
                    }
                    break
                case 'Discrete Math':
                    switch (mainTopic) {

                    }
                    break
                case 'Calculus':
                    switch (mainTopic) {
                        case 'Limits':
                            switch (extensionTopic) {
                                case 'One Variable':
                                    examples = ['\\lim_{x\\to\\ 1}\\left(\\frac{4x^{2}+5x+1}{3x+2}\\right)',
                                                '\\lim_{x\\to\\ 0}\\left(\\frac{1+\\cos(2x)}{1+x} \\right)',
                                                '\\lim_{x\\to\\ \\infty}\\left(\\frac{3x^{2}+9x+2}{10x^{2}+3x+1}\\right)'];
                                    break
                                case 'Multi Variable':
                                    // examples = ['\\lim_{(x,y)\\to\\ (1,1)}\\left(x^{2}+y^{2}+1\\right)',
                                    //             '\\lim_{(x,y)\\to\\ (2, 2)}\\left(\\frac{5x+2y^{2}+4}{5xy+3}\\right)'];
                                    examples = [];
                                    break
                                case 'One Sided':
                                    examples = ['\\lim_{x\\to\\ 0^{+}}\\left(\\frac{1}{x}\\right)',
                                                '\\lim_{x\\to\\ 8^{-}}\\left(\\frac{10}{x-8}\\right)',
                                                '\\lim_{x\\to\\ 1^{-}}\\left(\\frac{x}{x-1}\\right)'];
                                    break
                                case 'At Infinity':
                                    examples = ['\\lim_{x\\to\\ \\infty}\\left(\\frac{3x^{2}+9x+2}{7x^{2}+3x+1}\\right)',
                                                '\\lim_{x\\to\\ \\infty}\\left(\\frac{3x+1}{5x^{2}+9x+5}\\right)',
                                                '\\lim_{x\\to\\ \\infty}\\left(\\frac{9x^{3}+x+1}{7x^{2}+3x+9}\\right)'];
                                    break
                                case "L'Hopital's Rule":
                                    examples = ['\\lim_{\\theta\\to\\ 0}\\left(\\frac{\\sin(\\theta)}{\\theta}\\right)',
                                                '\\lim_{n\\to\\ \\infty}\\left(\\frac{n+3}{n-1}\\right)',
                                                '\\lim_{x\\to\\ \\infty}\\left(\\frac{5e^{2x}+3x^{2}+4}{7e^{3x}+x^{5}+9}\\right)'];
                                    break
                                case 'Squeeze Theorem':
                                    examples = ['\\lim_{x\\to\\ 0}\\left(x\\sin\\left(\\frac{1}{x}\\right)\\right)',
                                                '\\lim_{x\\to\\ \\infty}\\left(\\frac{\\sin(x)}{x}\\right)',
                                                '\\lim_{x\\to\\ 0}\\left(x^{2}\\cos\\left(\\frac{1}{x}\\right)\\right)'];
                                    break
                            }
                            break
                        case 'Derivatives':

                            break
                        case 'Derivative Applications':
                            break

                    }
                    break
            }
            return examples;
        }
        static getTopicsExtension(subject, mainTopic, returnDict=false) {
            let topicsExtension = {
                'Algebra': {
                    'Basic-Operations': ['Addition', 'Subtraction', 'Multiplication', 'Division'],
                    'Equations': ['Linear', 'Quadratic', 'Logarithmic', 'Exponential'],
                    'Summation': ['Single Summation', 'Double Summation', 'Triple Summation'],
                    'Pi-Product-Notation': ['Single Product', 'Double Product', 'Triple Product'],
                    'Polynomials': ['Properties', 'Add', 'Subtract', 'Multiply', 'Divide', 'Factor'],
                    'Rational-Expressions': ['Add', 'Subtract', 'Multiply', 'Divide', 'LCM', 'Reduce']
                },
                'Discrete Math': {
                    'Propositional-Logic': ['Truth Table', 'Logical Equivalence', 'Rules of Inference'],
                    'Set-Theory': ['Cartesian Product', 'Power Sets', 'Union', 'Intersection', 'Difference', 'Symmetric Difference', 'Computer Representation'],
                    'Induction': ['Prove Summation Formulas'],
                    'Number-Theory': ['Division Algorithm', 'Euclidean Algorithm', 'Arithmetic Modulo m', 'Modular Exponentiation', 'Congruences'],
                    'Relations': ['Properties', 'Combining Relations']
                },
                'Calculus': {
                    'Limits': ['One Variable', 'One Sided', 'At Infinity', "L'Hopital's Rule", 'Squeeze Theorem'],
                    'Derivatives': ['Sum/Diff Rule', 'Product Rule', 'Quotient Rule', 'Chain Rule', 'First Derivative', 'Higher Order Derivatives', 'Derivative At a Point', 'Partial Derivative', 'Implicit Derivative', 'Second Implicit Derivative', 'Derivative Using Definition'],
                    'Derivative-Applications': ['Equation of Tangent Line', 'Equation of Normal Line', 'Extreme Points', 'Linear Approximation', 'Quadratic Approximation', 'Related Rates', 'Optimization'],
                    'Integrals': ['Indefinite', 'Definite', 'Improper', 'Double Integrals', 'Triple Integrals', 'Numerical Integration'],
                    'Integral-Applications': ['Limit of Sum', 'Area Under Curve', 'Area Between Curves', 'Volume of Solid of Revolution', 'Function Average', 'Arc Length', 'Surface Area'],
                },
                'Probability': {
                    'Distributions': ['Normal Distribution', 'Exponential Distributions'],
                    'Expected Value': [''],
                    'Variance': [''],
                    'Bayes Theorem': [''],
                    'Combinations': [''],
                    'Permutations': [''],

                },
                'Physics': {
                    'Kinematics': ['1D Kinematics', '2D Kinematics'],
                    'Circular-Motion': ['Centripetal Force', 'Centripetal Velocity', 'Centripetal Acceleration', 'Tension in String', 'Period', 'Frequency'],
                    'Rotational-Motion': ['Angular Displacement', 'Angular Velocity', 'Angular Acceleration', 'Linear/Tangential Velocity', 'Linear/Tangential Acceleration'],
                    'Rotational-Dynamics': ['Torque', 'Moment of Inertia', 'Angular Momentum'],
                    "Newtons-2nd-Law": ['Dynamics Problem'],
                    'Momentum': ['Linear Momentum', 'Angular Momentum'],
                    'Work-and-Energy': ['Conservation of Energy', 'Work Energy Theorem'],
                    'Fluid-Mechanics': ['Properties of Fluids', 'Density', 'Pressure', 'Buoyant Forces', 'Apparent Weight', 'Continuity Equation', "Bernoulli's Equation"],
                    'Temperature-and-KT': ['Convert Between Scales', 'Ideal Gas Law', 'Thermal Expansion', 'Thermal Stress', "Newton's Law of Cooling", 'Relative Humidity', 'Diffusion', 'Kinetic Theory'],
                    'Heat': ['Internal Energy of an Ideal Gas', 'Specific Heat', 'Latent Heat', 'Conduction', 'Radiation'],
                    'Laws-of-Thermodynamics': ['First Law of Thermodynamics', 'Thermodynamic Processes', 'Work', 'Efficiency', 'Coefficient of Performance (COP)', 'Entropy and The Second Law of Thermodynamics']
                }
            }
            if (!(returnDict))
                return topicsExtension[subject][mainTopic];
            else
                return topicsExtension
        }

    }


    document.addEventListener('DOMContentLoaded', () => {


        var MQ = MathQuill.getInterface(2);
        var config = {
            spaceBehavesLikeTab: false,
            leftRightIntoCmdGoes: 'up',
            restrictMismatchedBrackets: true,
            sumStartsWithNEquals: true,
            supSubsRequireOperand: true,
            charsThatBreakOutOfSupSub: '=',
            autoSubscriptNumerals: true,
            autoCommands: 'pi theta sqrt sum int phi omega rho alpha beta',
            autoOperatorNames: 'sin cos tan sinh cosh tanh arcsin arccos arctan ln log csc sec cot',
            maxDepth: 10,
        }

        var userInput = document.getElementById('userInput');

        var answerMathField = MQ.MathField(userInput, config, {
            handlers: {
                edit: function() {},
                upOutOf: function(mathField) {},
                moveOutOf: function(dir, mathField) {
                    if (dir === MQ.L) {

                    }
                    else {

                    }
                },
                enter: function () {
                    alert('enter')
                }
            }
        });

        
        if (performance.navigation.type === performance.navigation.TYPE_RELOAD) { // Page reloaded
          // Storage.reloadSolution(answerMathField)
        }
        else {
            // console.log('not reloaded')
            // Storage.clear()
        }
        // const subject = document.querySelector('#selectedSubjectTabHeading').children[0].textContent;
        // console.log(subject)
        Storage.instantiateStorage();
        Storage.reloadSolution(answerMathField);


        checkIfUserIsStillLoggedIn();
        LayoutUI.loadSymbolsContainer();
        // Animations.animateShowAllSteps();

        /* KEYUP EVENTS */
        document.querySelector('#userInput').addEventListener('keyup', function () {
            let enteredMath = answerMathField.latex(); // Get entered math in LaTeX format
            let liveSolveRadioBtn = document.querySelector('#liveSolveRadioBtn')
            let liveSolveSolutionsContainer = document.querySelector('#liveSolveSolutionContainer')

            let selectedTopic = LayoutUI.getSelectedTopic()
            let subjectAndTopic = {'subject': 'algebra', 'selectedTopic': selectedTopic}



            // console.log(enteredMath)

        })


    })


    /* ON-CLICK EVENTS */

    // Subject Tabs - onclick
    document.querySelector('.subject-tabs').addEventListener('click', (e) => {
        if (e.target.classList.contains('subject-tab-btn')) {
            let subject = e.target.textContent
            let routes = {
                'Algebra': '/algebra',
                'Discrete Math': '/discrete_math',
                'Calculus': '/calculus',
                'Probability': '/probability',
                'Physics': '/physics',
            }
            Storage.clearLastSolution()
            window.location.href = routes[subject]
            // subjectTabsUI.subjectTabBtnSelected(e.target)
            // console.log('after')

        }
    })
    // Topic Extension Item
    document.querySelector('#sidebar').addEventListener('click', (e) => {
        if (e.target.classList.contains('topics-btn')) {
            let pm = ''
            if (e.target.textContent.includes('+')) {
                // Collapse all other sections
                document.querySelectorAll('.topics-btn').forEach((btn) => {
                    if (btn !== e.target) {
                        if (btn.style.ariaExpanded === 'true') {
                            btn.click();
                        }
                    }
                })

                e.target.style.ariaExpanded = 'true';
                pm = '-';
                e.target.innerHTML = e.target.innerHTML.replace('+', pm);

            }
            else {
                e.target.style. ariaExpanded = 'false';
                pm = '+';
                e.target.innerHTML = e.target.innerHTML.replace('-', pm);
            }

            let mainTopic = e.target.textContent;
            mainTopic = replaceAll(replaceAll(mainTopic.trim(), '\\n', ''), `${pm} `, '');
            LayoutUI.extensionTopicClicked(mainTopic, '');
            LayoutUI.loadExamples();
            Storage.addLastTopicClicked(mainTopic);
        }
        if (e.target.className === 'topic-extension-item') {
            let extensionTopic = e.target.textContent
            let mainTopic = e.target.parentElement.parentElement.parentElement.previousElementSibling.textContent
            mainTopic = replaceAll(replaceAll(mainTopic.trim(), '\\n', ''), '+ ', '')
            LayoutUI.extensionTopicClicked(mainTopic, extensionTopic)
            LayoutUI.loadExamples()
        }
    })


    /* ON-CLICK EVENTS */
    document.querySelector('#skyRatingsHeaderBtn').addEventListener('click', () => {
        Storage.clearLastSolution()
    })

    /* ON-HOVER EVENTS */

    // Subject Tabs
    document.querySelector('.subject-tabs').addEventListener('mouseover', (e) => {
        let subjectOptionsDiv = document.querySelector('.subject-topics')

        if (e.target.classList.contains('subject-tab-btn')) {
            let btnObj = e.target
            let btnSubjectPos = {
                'algebra': '275px',
                'discreteMath': '340px',
                'calculus': '455px',
                'probability': '535px',
                'physics': '625px',
            }
            let subjectOptions = SubjectTabsUI.getSubjectTopics()

            switch (btnObj.textContent) {
                case "Algebra":
                    subjectOptionsDiv.style.left = btnSubjectPos['algebra']
                    SubjectTabsUI.populateSubjectOptions(subjectOptions['algebra'])
                    break
                case "Discrete Math":
                    subjectOptionsDiv.style.left = btnSubjectPos['discreteMath']
                    SubjectTabsUI.populateSubjectOptions(subjectOptions['discreteMath'])
                    break
                case "Calculus":
                    subjectOptionsDiv.style.left = btnSubjectPos['calculus']
                    SubjectTabsUI.populateSubjectOptions(subjectOptions['calculus'])
                    break
                case "Probability":
                    subjectOptionsDiv.style.left = btnSubjectPos['probability']
                    SubjectTabsUI.populateSubjectOptions(subjectOptions['probability'])
                    break
                case "Physics":
                    subjectOptionsDiv.style.left = btnSubjectPos['physics']
                    SubjectTabsUI.populateSubjectOptions(subjectOptions['physics'])
                    break

            }
        }
    })
    // Container-1
    document.querySelector('.heading-container').addEventListener('mouseover', (e) => {
        if (e.target.classList.contains('subject-option-btn') || e.target.classList.contains('subject-tab-btn') || e.target.className === 'subject-topics') {
            SubjectTabsUI.showSubjectTopics()
        }
        else {
            SubjectTabsUI.removeSubjectTopics()
        }
    })




    function getRandomInt(max) {
        return Math.floor(Math.random() * max);
    }
    function extractAllSimplificationsFromSolution(solution) {
        let allSimplifications = {}
        let i = 1
        for (let stepNum in solution) {
            allSimplifications[stepNum] = solution[stepNum]['simplification']

        }
        return allSimplifications
    }
    function escapeRegExp(string) {
        return string.replace(/[.*+\-?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
    }
    function replaceAll(str, find, replace) {
        return str.replace(new RegExp(escapeRegExp(find), 'g'), replace);
    }

</script>

{% block script1 %}
{% endblock %}

{% endblock %}



